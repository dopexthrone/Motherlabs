
> context-engine-kernel@0.1.0 test
> node --test dist/tests/*.test.js dist/harness/tests/*.test.js dist/tools/tests/*.test.js dist/consumer/tests/*.test.js dist/protocol/tests/*.test.js

▶ Bundle Summary
  ▶ Outcome Detection
    ✔ detects BUNDLE outcome for complete status (3.843659ms)
    ✔ detects CLARIFY outcome for incomplete status (0.737964ms)
    ✔ detects REFUSE outcome for error status (0.479209ms)
  ✔ Outcome Detection (5.562783ms)
  ▶ Field Extraction
    ✔ extracts schema_version correctly (0.894949ms)
    ✔ computes bundle_hash (0.606607ms)
    ✔ counts artifacts correctly (0.567314ms)
    ✔ counts unresolved questions correctly (0.92759ms)
    ✔ counts terminal nodes correctly (1.152572ms)
  ✔ Field Extraction (4.588656ms)
  ▶ Sorting
    ✔ artifact_paths are sorted lexicographically (2.609684ms)
    ✔ question_ids are sorted by priority desc, id asc (0.919785ms)
    ✔ terminal_node_ids are sorted lexicographically (0.799409ms)
  ✔ Sorting (4.659669ms)
  ▶ Determinism
    ✔ produces identical summary for same bundle (1.83959ms)
    ✔ summary is byte-identical across multiple runs (1.283016ms)
    ✔ canonical JSON has sorted keys (0.737924ms)
  ✔ Determinism (4.158268ms)
  ▶ Edge Cases
    ✔ handles bundle with no outputs (1.439109ms)
    ✔ handles bundle with no unresolved questions (1.158663ms)
    ✔ handles bundle with no terminal nodes (1.079334ms)
  ✔ Edge Cases (3.884265ms)
✔ Bundle Summary (23.238622ms)
▶ Bundle Verification
  ▶ Valid Bundles
    ✔ accepts valid BUNDLE outcome (3.686754ms)
    ✔ accepts valid CLARIFY outcome (0.952657ms)
    ✔ accepts valid REFUSE outcome (0.508814ms)
  ✔ Valid Bundles (5.672168ms)
  ▶ Invalid Bundles
    ✔ rejects bundle with unsorted output paths (BS3) (1.753118ms)
    ✔ rejects bundle with path traversal (BS7) (0.689724ms)
    ✔ rejects non-object bundle (0.152886ms)
    ✔ rejects null bundle (0.126327ms)
    ✔ rejects bundle with missing schema_version (BS1) (0.204864ms)
    ✔ rejects bundle with empty schema_version (BS1) (0.12759ms)
  ✔ Invalid Bundles (3.374729ms)
  ▶ Violation Ordering
    ✔ violations are sorted by rule_id then path (0.785042ms)
  ✔ Violation Ordering (0.861686ms)
  ▶ Determinism
    ✔ produces identical result for same input (2.54889ms)
    ✔ violations are byte-identical across runs (0.592421ms)
  ✔ Determinism (3.275503ms)
✔ Bundle Verification (13.509435ms)
▶ Pack Verification
  ▶ PK1: Required Files Exist
    ✔ valid pack with run.json and bundle.json passes (1.73286ms)
    ✔ missing run.json fails (0.282931ms)
    ✔ missing bundle.json for BUNDLE outcome fails (0.161623ms)
    ✔ REFUSE outcome without bundle.json passes (0.136727ms)
  ✔ PK1: Required Files Exist (2.668374ms)
  ▶ PK2: No Unknown Files
    ✔ pack with only manifest files passes (0.386415ms)
    ✔ pack with unknown file fails (0.37844ms)
  ✔ PK2: No Unknown Files (0.845926ms)
  ▶ PK3: Run Spec Valid
    ✔ valid run.json passes (0.397806ms)
    ✔ run.json with missing fields fails (0.666029ms)
  ✔ PK3: Run Spec Valid (1.193939ms)
  ▶ PK4: Bundle Spec Valid
    ✔ valid bundle.json passes (0.359364ms)
    ✔ invalid bundle.json fails deep validation (0.664366ms)
    ✔ skips bundle validation when deepValidation=false (0.38915ms)
  ✔ PK4: Bundle Spec Valid (1.519179ms)
  ▶ PK5: Hash Match (run -> bundle)
    ✔ matching hash passes (1.030071ms)
    ✔ mismatched hash fails (0.350517ms)
    ✔ skips hash verification when verifyReferences=false (0.287018ms)
  ✔ PK5: Hash Match (run -> bundle) (1.790428ms)
  ▶ PK6: No Symlinks
    ✔ regular files pass (0.374743ms)
    ✔ symlink file fails (3.187708ms)
  ✔ PK6: No Symlinks (3.669652ms)
  ▶ PK7: No Path Traversal
    ✔ normal path passes (0.472085ms)
  ✔ PK7: No Path Traversal (0.562946ms)
  ▶ PK8: Optional Files Valid
    ✔ pack with all optional files passes (1.024351ms)
    ✔ invalid patch.json in pack fails (0.791735ms)
  ✔ PK8: Optional Files Valid (1.927816ms)
  ▶ PK9: Ledger Format Valid
    ✔ valid ledger.jsonl passes (0.518052ms)
    ✔ invalid JSONL format fails (0.737222ms)
  ✔ PK9: Ledger Format Valid (1.357276ms)
  ▶ PK10: Stable Violations
    ✔ violations are deterministically sorted (1.883853ms)
  ✔ PK10: Stable Violations (2.01049ms)
  ▶ PK11: Meta Ignored
    ✔ meta.json is parsed but not validated (1.135129ms)
    ✔ invalid JSON in meta.json fails (0.793418ms)
  ✔ PK11: Meta Ignored (2.025208ms)
  ▶ PK12: Regular Files Only
    ✔ regular files pass (0.320311ms)
  ✔ PK12: Regular Files Only (0.497493ms)
  ▶ Valid Pack Fixtures
    ✔ valid_pack_bundle passes (0.35756ms)
    ✔ valid_pack_clarify passes (0.273172ms)
    ✔ valid_pack_refuse passes (0.144911ms)
    ✔ valid_pack_full passes (0.372849ms)
  ✔ Valid Pack Fixtures (1.249494ms)
  ▶ IO Errors
    ✔ non-existent directory fails (0.114665ms)
    ✔ file instead of directory fails (0.423004ms)
  ✔ IO Errors (0.617888ms)
  ▶ Success Result Structure
    ✔ includes files_verified on success (0.499256ms)
    ✔ includes reference_checks on success (0.694232ms)
  ✔ Success Result Structure (1.269692ms)
✔ Pack Verification (23.855268ms)
▶ Patch Verification
  ▶ PS1: Schema Version Present
    ✔ valid schema version passes (0.758373ms)
    ✔ missing schema version fails (0.150642ms)
    ✔ empty schema version fails (0.149831ms)
  ✔ PS1: Schema Version Present (1.470238ms)
  ▶ PS2: Op Enum Valid
    ✔ create op passes (0.143549ms)
    ✔ modify op passes (0.104266ms)
    ✔ delete op passes (0.127259ms)
    ✔ invalid op fails (0.12817ms)
  ✔ PS2: Op Enum Valid (0.673012ms)
  ▶ PS3: Path Relative Only
    ✔ relative path passes (0.105107ms)
    ✔ absolute path fails (3.644475ms)
    ✔ Windows drive path fails (0.214232ms)
  ✔ PS3: Path Relative Only (4.161945ms)
  ▶ PS4: No Path Traversal
    ✔ normal path passes (0.130204ms)
    ✔ traversal path fails (3.224057ms)
    ✔ backslash path fails (0.173625ms)
    ✔ dot-slash path fails (0.09601ms)
    ✔ double-slash path fails (0.071524ms)
    ✔ trailing slash path fails (0.071044ms)
  ✔ PS4: No Path Traversal (3.958093ms)
  ▶ PS5: No Duplicate Targets
    ✔ unique paths pass (0.0904ms)
    ✔ duplicate paths fail (1.369979ms)
  ✔ PS5: No Duplicate Targets (1.555678ms)
  ▶ PS6: Text Only UTF-8
    ✔ valid UTF-8 passes (0.070302ms)
    ✔ null bytes fail (0.439825ms)
    ✔ delete with content fails (0.090299ms)
    ✔ create without content fails (0.043983ms)
  ✔ PS6: Text Only UTF-8 (0.717165ms)
  ▶ PS7: Max Bytes Enforced
    ✔ within limit passes (0.070202ms)
    ✔ exceeds limit fails (0.065212ms)
    ✔ mismatched total_bytes fails (0.04251ms)
  ✔ PS7: Max Bytes Enforced (0.247133ms)
  ▶ PS8: Sorting Canonical
    ✔ properly sorted passes (0.065793ms)
    ✔ unsorted by order fails (0.105006ms)
    ✔ unsorted by path (same order) fails (0.080561ms)
  ✔ PS8: Sorting Canonical (0.317235ms)
  ▶ PS9: No Symlink Intent
    ✔ symlink op fails (0.064831ms)
  ✔ PS9: No Symlink Intent (0.099196ms)
  ▶ PS10: Stable Violations
    ✔ violations are sorted by rule_id then path (0.302908ms)
  ✔ PS10: Stable Violations (0.358552ms)
  ▶ Fixture: Valid Patch
    ✔ valid fixture passes all checks (2.952397ms)
  ✔ Fixture: Valid Patch (3.065789ms)
  ▶ Schema Errors
    ✔ null input fails (0.14371ms)
    ✔ array input fails (0.082054ms)
    ✔ missing required fields fails (0.087664ms)
  ✔ Schema Errors (0.410701ms)
✔ Patch Verification (18.138086ms)
▶ Evidence Spec Invariants
  ▶ EV1: Proposal Hash Integrity
    ✔ valid evidence has valid proposal_hash (0.443562ms)
    ✔ rejects missing proposal_hash (0.237025ms)
    ✔ rejects invalid hash format (0.680356ms)
    ✔ accepts sha256-prefixed hash (0.082435ms)
    ✔ accepts bare hex hash (0.054873ms)
  ✔ EV1: Proposal Hash Integrity (1.912637ms)
  ▶ EV2: Action Results Consistency
    ✔ valid action results pass (0.135655ms)
    ✔ rejects missing action_id (0.088306ms)
    ✔ rejects invalid status (0.068078ms)
    ✔ rejects negative duration_ms (0.129222ms)
    ✔ accepts all valid status types (0.118602ms)
  ✔ EV2: Action Results Consistency (0.68784ms)
  ▶ EV3: Test Results Validity
    ✔ valid test results pass (0.09096ms)
    ✔ rejects missing test_id (0.107942ms)
    ✔ rejects non-boolean passed (0.079359ms)
    ✔ rejects non-string actual (0.244218ms)
  ✔ EV3: Test Results Validity (0.615975ms)
  ▶ EV4: Status Consistency
    ✔ complete status with successful actions passes (0.148438ms)
    ✔ failed status with failures passes (0.061175ms)
    ✔ partial status passes (0.054833ms)
    ✔ rejects complete status with failures (0.058069ms)
    ✔ rejects invalid status value (0.066625ms)
  ✔ EV4: Status Consistency (0.509606ms)
  ▶ EV5: Evidence Hash Determinism
    ✔ hash is deterministic for same evidence (0.44789ms)
    ✔ hash is same regardless of ephemeral fields (0.082715ms)
    ✔ hash differs for different core fields (0.09591ms)
    ✔ hash is deterministic for complex evidence (5.015646ms)
  ✔ EV5: Evidence Hash Determinism (5.799507ms)
  ▶ All Invariants Combined
    ✔ valid evidence passes all invariants (0.281588ms)
    ✔ failed evidence passes all invariants (0.142737ms)
    ✔ partial evidence passes all invariants (0.124815ms)
  ✔ All Invariants Combined (0.697318ms)
  ▶ EvidenceCore Computation
    ✔ computeEvidenceCore excludes ephemeral fields (0.113723ms)
    ✔ computeEvidenceCore sorts action_results by action_id (0.102442ms)
    ✔ computeEvidenceCore sorts test_results by test_id (0.087113ms)
  ✔ EvidenceCore Computation (0.396915ms)
✔ Evidence Spec Invariants (11.113803ms)
▶ Harness: Plan-Only Mode
  ✔ processes simple intent without execution (7.251189ms)
  ✔ handles clarify result for vague intent (19.711156ms)
  ✔ produces deterministic results for same intent (2.372469ms)
✔ Harness: Plan-Only Mode (30.243939ms)
▶ Harness: Execute-Sandbox Mode
  ✔ executes proposal in sandbox and captures evidence (5.349673ms)
  ✔ sandbox never writes outside sandbox dir (4.458612ms)
  ✔ respects policy timeout (0.191319ms)
✔ Harness: Execute-Sandbox Mode (10.309164ms)
▶ Harness: Policy Profiles
  ✔ strict policy has most restrictive settings (0.149069ms)
  ✔ default policy is balanced (0.083817ms)
  ✔ dev policy is relaxed (0.457979ms)
  ✔ policy is included in result (1.777704ms)
✔ Harness: Policy Profiles (2.670899ms)
▶ Harness: Kernel Authority
  ✔ kernel generates bundle (harness does not) (1.004994ms)
  ✔ kernel validates evidence (harness does not decide) (7.006109ms)
✔ Harness: Kernel Authority (8.245844ms)
▶ Harness: Result Structure
  ✔ result has all required fields (1.445351ms)
  ✔ timestamps are valid ISO 8601 UTC (2.0688ms)
✔ Harness: Result Structure (3.78068ms)
▶ Ledger Spec Invariants
  ▶ LD1: One Entry Per Line
    ✔ valid single entry parses correctly (0.820709ms)
    ✔ valid multiple entries parse correctly (0.227006ms)
    ✔ rejects invalid JSON (0.426239ms)
    ✔ rejects missing required fields (0.168816ms)
    ✔ rejects invalid result_kind (0.198592ms)
    ✔ rejects invalid mode (0.18644ms)
    ✔ rejects invalid policy (0.187892ms)
    ✔ accepts all valid result_kind values (0.187712ms)
    ✔ accepts all valid mode values (0.139051ms)
    ✔ accepts all valid policy values (0.172825ms)
  ✔ LD1: One Entry Per Line (3.49804ms)
  ▶ LD2: Monotonic Timestamps
    ✔ ascending timestamps pass (0.193232ms)
    ✔ equal timestamps pass (0.062918ms)
    ✔ descending timestamps fail (0.123682ms)
    ✔ single entry passes (0.044483ms)
    ✔ empty array passes (0.048191ms)
  ✔ LD2: Monotonic Timestamps (0.601408ms)
  ▶ LD3: Unique Run IDs
    ✔ unique run_ids pass (0.108924ms)
    ✔ duplicate run_ids fail (0.122489ms)
    ✔ single entry passes (0.05295ms)
    ✔ empty array passes (0.039424ms)
  ✔ LD3: Unique Run IDs (0.414568ms)
  ▶ LD4: Valid Content Hashes
    ✔ valid hashes pass (0.171692ms)
    ✔ null bundle_sha256 passes (0.077766ms)
    ✔ invalid intent_sha256 fails (0.158507ms)
    ✔ invalid bundle_sha256 fails (0.099647ms)
    ✔ hash without sha256 prefix fails (0.152686ms)
    ✔ hash with wrong length fails (0.083096ms)
  ✔ LD4: Valid Content Hashes (0.881223ms)
  ▶ All Invariants Combined
    ✔ valid ledger passes all checks (0.151404ms)
    ✔ empty ledger passes (0.05292ms)
    ✔ single valid entry passes (0.078747ms)
  ✔ All Invariants Combined (0.388979ms)
  ▶ serializeLedgerEntry
    ✔ produces canonical JSON (0.230773ms)
    ✔ produces valid JSON (0.073467ms)
    ✔ serialized entry passes invariant checks (0.066104ms)
  ✔ serializeLedgerEntry (0.454613ms)
  ▶ createLedgerEntry
    ✔ creates valid entry from HarnessRunResult (0.299422ms)
    ✔ created entry passes invariant checks (0.13337ms)
    ✔ handles null bundle correctly (0.061947ms)
  ✔ createLedgerEntry (0.570911ms)
  ▶ Content Hash Validation
    ✔ isValidContentHash accepts valid hashes (0.10663ms)
    ✔ isValidContentHash rejects invalid hashes (0.060764ms)
  ✔ Content Hash Validation (0.224551ms)
✔ Ledger Spec Invariants (8.445218ms)
▶ Policy Spec Invariants
  ▶ PL1: Profile Enum
    ✔ strict profile has valid name (0.516869ms)
    ✔ default profile has valid name (0.108073ms)
    ✔ dev profile has valid name (0.090049ms)
    ✔ listPolicies returns all three profiles (0.604173ms)
  ✔ PL1: Profile Enum (1.945359ms)
  ▶ PL2: Resolved Complete
    ✔ strict profile is fully populated (0.179025ms)
    ✔ default profile is fully populated (0.286979ms)
    ✔ dev profile is fully populated (0.104777ms)
    ✔ all profiles have no undefined values (0.18111ms)
  ✔ PL2: Resolved Complete (0.976982ms)
  ▶ PL3: Limits Within Bounds
    ✔ strict profile limits are within bounds (0.690575ms)
    ✔ default profile limits are within bounds (0.12277ms)
    ✔ dev profile limits are within bounds (0.086121ms)
    ✔ strict has most restrictive timeout (0.075101ms)
    ✔ strict has most restrictive file limits (0.095319ms)
    ✔ strict has most restrictive byte limits (0.060944ms)
  ✔ PL3: Limits Within Bounds (1.302373ms)
  ▶ PL4: Model Mode Strict/Default
    ✔ strict allows only none mode (0.110287ms)
    ✔ default allows only none mode (0.045996ms)
    ✔ strict rejects record with PL4 error (0.330189ms)
    ✔ strict rejects replay with PL4 error (0.111088ms)
    ✔ default rejects record with PL4 error (0.096802ms)
    ✔ default rejects replay with PL4 error (0.108173ms)
    ✔ error message is stable and deterministic (0.10678ms)
  ✔ PL4: Model Mode Strict/Default (1.054698ms)
  ▶ PL5: Model Mode Dev
    ✔ dev allows all modes (0.096431ms)
    ✔ dev none mode requires no recording path (0.043271ms)
    ✔ dev record mode requires recording path (0.096662ms)
    ✔ dev replay mode requires recording path (0.085831ms)
    ✔ dev record mode with path passes (0.042579ms)
    ✔ dev replay mode with path passes (0.041848ms)
    ✔ PL5 error message is stable (0.086933ms)
  ✔ PL5: Model Mode Dev (0.631725ms)
  ▶ PL6: Sandbox Constraints
    ✔ strict allows only specified commands (0.123051ms)
    ✔ default allows specified commands (0.060794ms)
    ✔ dev allows all commands (empty list) (0.05364ms)
    ✔ strict allows only specified write roots (0.097152ms)
    ✔ default allows more write roots (0.432831ms)
    ✔ dev allows all write paths (empty list) (0.112301ms)
  ✔ PL6: Sandbox Constraints (1.025423ms)
  ▶ PL7: Evidence Policy Binding
    ✔ harness result includes full policy object (26.010359ms)
    ✔ policy in result matches resolved policy exactly (4.971724ms)
    ✔ policy binding is deterministic across runs (2.305534ms)
  ✔ PL7: Evidence Policy Binding (33.621694ms)
  ▶ Deterministic Resolution
    ✔ loadPolicy returns identical object for same profile (0.169999ms)
    ✔ loadPolicy is byte-identical across multiple calls (0.245951ms)
    ✔ profile values match documented spec (0.235392ms)
  ✔ Deterministic Resolution (0.819667ms)
  ▶ All Invariants Combined
    ✔ strict profile passes all invariants (0.124664ms)
    ✔ default profile passes all invariants (0.047058ms)
    ✔ dev profile passes all invariants (0.057187ms)
  ✔ All Invariants Combined (0.512942ms)
✔ Policy Spec Invariants (42.729264ms)
▶ Run Spec Invariants
  ▶ RS1: Schema Version Present
    ✔ valid schema version passes (0.496431ms)
    ✔ missing schema version fails (0.328836ms)
    ✔ empty schema version fails (0.11725ms)
  ✔ RS1: Schema Version Present (1.442315ms)
  ▶ RS2: Outcome Coverage
    ✔ BUNDLE outcome passes (0.16523ms)
    ✔ CLARIFY outcome passes (0.075942ms)
    ✔ REFUSE outcome passes (0.074119ms)
    ✔ invalid outcome fails (0.109766ms)
  ✔ RS2: Outcome Coverage (0.591839ms)
  ▶ RS3: Outcome-Field Consistency
    ✔ BUNDLE with non-null bundle passes (0.176381ms)
    ✔ BUNDLE with null bundle fails (0.302017ms)
    ✔ BUNDLE with clarify_questions fails (0.187802ms)
    ✔ CLARIFY with clarify_questions passes (0.066845ms)
    ✔ CLARIFY without clarify_questions fails (0.093746ms)
    ✔ REFUSE with refuse_reason passes (0.098565ms)
    ✔ REFUSE without refuse_reason fails (0.115056ms)
  ✔ RS3: Outcome-Field Consistency (1.28006ms)
  ▶ RS4: Reference Integrity
    ✔ valid hashes pass (0.148288ms)
    ✔ invalid intent hash fails (0.094928ms)
    ✔ invalid bundle hash fails (0.083968ms)
    ✔ empty bundle_id fails (0.087584ms)
  ✔ RS4: Reference Integrity (0.505227ms)
  ▶ RS5: Policy Binding
    ✔ matching policy passes (0.234981ms)
    ✔ modified policy fails (0.104956ms)
  ✔ RS5: Policy Binding (0.399028ms)
  ▶ RS6: No Leak
    ✔ relative path passes (0.102151ms)
    ✔ absolute path fails (0.099256ms)
    ✔ Windows absolute path fails (0.091922ms)
  ✔ RS6: No Leak (0.359955ms)
  ▶ RS7: Canonical Output
    ✔ valid result is canonically stable (0.187792ms)
    ✔ result with arrays is canonically stable (0.102262ms)
  ✔ RS7: Canonical Output (0.344907ms)
  ▶ RS8: Decision Consistency
    ✔ validated_by_kernel true passes (0.230422ms)
    ✔ validated_by_kernel false fails (0.118953ms)
    ✔ CLARIFY with accepted true fails (0.110457ms)
    ✔ REFUSE with accepted true fails (0.089278ms)
  ✔ RS8: Decision Consistency (0.636123ms)
  ▶ All Invariants Combined
    ✔ valid BUNDLE result passes all checks (0.286968ms)
    ✔ valid CLARIFY result passes all checks (0.225333ms)
    ✔ valid REFUSE result passes all checks (0.108643ms)
  ✔ All Invariants Combined (0.701946ms)
  ▶ Integration: Real Harness Run
    ✔ runHarness produces spec-compliant result (27.685241ms)
    ✔ runHarness uses sanitized intent path (1.678388ms)
    ✔ runHarness produces canonical output (1.343229ms)
  ✔ Integration: Real Harness Run (30.949192ms)
✔ Run Spec Invariants (37.811251ms)
▶ Security: Symlink Escape
  ✔ refuses to follow symlinks in output directory (9.364422ms)
  ✔ refuses to follow directory symlinks (1.846944ms)
✔ Security: Symlink Escape (12.046642ms)
▶ Security: Path Traversal
  ✔ validates isPathSafe correctly (4.344928ms)
  ✔ rejects absolute paths in output (3.07646ms)
✔ Security: Path Traversal (7.71018ms)
▶ Security: File Spam
  ✔ respects max_output_files limit (65.110528ms)
  ✔ respects max_total_output_bytes limit (32.205257ms)
✔ Security: File Spam (97.614475ms)
▶ Security: Deep Recursion
  ✔ limits directory traversal depth (5.42287ms)
  ✔ allows directories within depth limit (1.451372ms)
✔ Security: Deep Recursion (7.07077ms)
▶ Security: Combined Attacks
  ✔ handles multiple security issues simultaneously (8.790846ms)
✔ Security: Combined Attacks (8.895342ms)
▶ Proposal Verification (Internal)
  ▶ PR1: Schema Version Present
    ✔ valid schema version passes (0.892784ms)
    ✔ missing schema version fails (0.237645ms)
    ✔ empty schema version fails (0.135044ms)
    ✔ fixture: missing schema version fails (4.52713ms)
  ✔ PR1: Schema Version Present (6.3989ms)
  ▶ PR2: Source References Valid
    ✔ valid source references pass (0.167795ms)
    ✔ missing source_bundle_id fails (0.400561ms)
    ✔ empty source_bundle_id fails (0.208952ms)
    ✔ fixture: invalid source ref fails (8.368214ms)
  ✔ PR2: Source References Valid (9.828562ms)
  ▶ PR3: Actions Array Present
    ✔ actions array present passes (0.251151ms)
    ✔ empty actions array passes (0.173025ms)
    ✔ missing actions array fails (0.126417ms)
  ✔ PR3: Actions Array Present (0.706775ms)
  ▶ PR4: Action IDs Unique
    ✔ unique action IDs pass (0.125535ms)
    ✔ duplicate action IDs fail (4.80421ms)
  ✔ PR4: Action IDs Unique (5.148205ms)
  ▶ PR5: Action Types Valid
    ✔ valid action types pass (0.126157ms)
    ✔ execute_command action passes (0.080812ms)
    ✔ invalid action type fails (2.909376ms)
  ✔ PR5: Action Types Valid (3.243463ms)
  ▶ PR6: Action IDs Well-Formed
    ✔ well-formed action IDs pass (0.074951ms)
    ✔ malformed action ID fails in strict mode (0.06392ms)
    ✔ malformed action ID passes in relaxed mode (0.066765ms)
  ✔ PR6: Action IDs Well-Formed (0.275877ms)
  ▶ PR7: Test IDs Unique
    ✔ unique test IDs pass (0.065793ms)
    ✔ duplicate test IDs fail (0.050735ms)
  ✔ PR7: Test IDs Unique (0.153057ms)
  ▶ PR8: Test Types Valid
    ✔ valid test types pass (0.05295ms)
    ✔ invalid test type fails (0.059611ms)
  ✔ PR8: Test Types Valid (0.157395ms)
  ▶ PR9: Confidence Range Valid
    ✔ confidence 0 passes (0.086061ms)
    ✔ confidence 100 passes (0.035557ms)
    ✔ confidence -1 fails (0.046657ms)
    ✔ confidence 101 fails (7.798435ms)
    ✔ confidence as float fails (0.184176ms)
  ✔ PR9: Confidence Range Valid (8.364907ms)
  ▶ PR10: Summary Non-Empty
    ✔ non-empty summary passes (0.129453ms)
    ✔ missing summary fails (0.109124ms)
    ✔ empty summary fails (0.071343ms)
  ✔ PR10: Summary Non-Empty (0.407775ms)
  ▶ PR11: Sorting Canonical
    ✔ properly sorted actions pass (0.115737ms)
    ✔ unsorted actions fail (1.543204ms)
    ✔ unsorted tests fail (0.13324ms)
  ✔ PR11: Sorting Canonical (1.886819ms)
  ▶ PR12: File Actions Have Content
    ✔ create_file with content passes (0.060323ms)
    ✔ create_file without content fails (0.92249ms)
    ✔ delete_file without content passes (0.111258ms)
    ✔ delete_file with content fails (0.099617ms)
  ✔ PR12: File Actions Have Content (1.296702ms)
  ▶ Fixture: Valid Proposal
    ✔ valid fixture passes all checks (1.647981ms)
  ✔ Fixture: Valid Proposal (1.726979ms)
  ▶ Stable Violations
    ✔ violations are sorted by rule_id then path (0.324418ms)
  ✔ Stable Violations (0.361147ms)
  ▶ Schema Errors
    ✔ null input fails (0.060865ms)
    ✔ array input fails (0.025958ms)
    ✔ empty object fails (0.059392ms)
  ✔ Schema Errors (0.192331ms)
✔ Proposal Verification (Internal) (40.94627ms)
▶ MockModelAdapter
  ✔ should return configured response for exact prompt (2.531888ms)
  ✔ should throw AdapterError for unmatched prompt in strict mode (0.530034ms)
  ✔ should echo prompt in echo mode (0.1868ms)
  ✔ should return fixed content in fixed mode (0.226264ms)
  ✔ should match substring patterns (0.157195ms)
  ✔ should record interactions when enabled (0.441758ms)
  ✔ should export recording session (0.230773ms)
  ✔ should report ready state correctly (0.161092ms)
  ✔ should have correct adapter_id and model_id (0.931256ms)
  ✔ should estimate tokens from content length (0.228589ms)
✔ MockModelAdapter (6.632338ms)
▶ RecordingModelAdapter
  ✔ should record interactions from delegate (0.323376ms)
  ✔ should delegate transform calls correctly (0.11682ms)
  ✔ should compute stats correctly (0.193372ms)
  ✔ should respect max_interactions limit (0.178114ms)
  ✔ should redact prompts when include_prompts is false (0.107882ms)
  ✔ should delegate isReady and shutdown (0.11202ms)
✔ RecordingModelAdapter (1.235698ms)
▶ ReplayModelAdapter
  ✔ should replay recorded response by prompt hash (0.506489ms)
  ✔ should throw for unrecorded prompt in strict mode (0.201057ms)
  ✔ should return empty content for unrecorded prompt in non-strict mode (0.097152ms)
  ✔ should enforce sequence order in sequential mode (0.115146ms)
  ✔ should fail in sequential mode if prompts are out of order (0.170129ms)
  ✔ should report recording count (0.119995ms)
  ✔ should check hasRecording correctly (0.136265ms)
  ✔ should always be ready (0.135785ms)
✔ ReplayModelAdapter (1.717081ms)
▶ Record and Replay Integration
  ✔ should produce identical results when replaying recorded session (0.798928ms)
  ✔ should create adapter from recording session (0.294423ms)
✔ Record and Replay Integration (1.18406ms)
▶ Adapter Determinism
  ✔ should produce identical results across multiple runs (0.198192ms)
  ✔ should produce same hash for same prompt regardless of context metadata (0.083828ms)
✔ Adapter Determinism (0.349616ms)
▶ Adversarial: Unicode Normalization
  ✔ A-umlaut: NFC and NFD produce identical normalized output (0.60802ms)
  ✔ O-umlaut: NFC and NFD produce identical normalized output (0.097042ms)
  ✔ U-umlaut: NFC and NFD produce identical normalized output (0.054332ms)
  ✔ e-acute: NFC and NFD produce identical normalized output (0.072476ms)
  ✔ n-tilde: NFC and NFD produce identical normalized output (0.077846ms)
  ✔ c-cedilla: NFC and NFD produce identical normalized output (0.038853ms)
  ✔ a-grave: NFC and NFD produce identical normalized output (0.030227ms)
  ✔ mixed NFC/NFD in constraints produce identical hashes (0.630071ms)
  ✔ Korean Hangul syllables (precomposed vs jamo) (16.258161ms)
✔ Adversarial: Unicode Normalization (18.765383ms)
▶ Adversarial: Zero-Width Characters
  ✔ ZWSP at start of goal is handled (4.081444ms)
  ✔ ZWSP at end of goal is handled (5.265224ms)
  ✔ ZWSP in middle of goal is handled (3.833619ms)
  ✔ multiple ZWSP in constraints are handled (4.027823ms)
  ✔ ZWNJ at start of goal is handled (3.216653ms)
  ✔ ZWNJ at end of goal is handled (4.322797ms)
  ✔ ZWNJ in middle of goal is handled (3.056231ms)
  ✔ multiple ZWNJ in constraints are handled (3.385669ms)
  ✔ ZWJ at start of goal is handled (2.514777ms)
  ✔ ZWJ at end of goal is handled (2.709812ms)
  ✔ ZWJ in middle of goal is handled (2.560963ms)
  ✔ multiple ZWJ in constraints are handled (3.078734ms)
  ✔ BOM at start of goal is handled (2.549852ms)
  ✔ BOM at end of goal is handled (2.113053ms)
  ✔ BOM in middle of goal is handled (2.12179ms)
  ✔ multiple BOM in constraints are handled (2.134213ms)
  ✔ WJ at start of goal is handled (2.166113ms)
  ✔ WJ at end of goal is handled (2.049654ms)
  ✔ WJ in middle of goal is handled (1.990974ms)
  ✔ multiple WJ in constraints are handled (2.148349ms)
  ✔ NBSP at start of goal is handled (3.533817ms)
  ✔ NBSP at end of goal is handled (1.804223ms)
  ✔ NBSP in middle of goal is handled (2.001524ms)
  ✔ multiple NBSP in constraints are handled (2.174679ms)
  ✔ NNBSP at start of goal is handled (2.012374ms)
  ✔ NNBSP at end of goal is handled (2.310834ms)
  ✔ NNBSP in middle of goal is handled (1.78625ms)
  ✔ multiple NNBSP in constraints are handled (2.559029ms)
  ✔ RTL override characters are handled safely (0.390632ms)
  ✔ combining diacritical marks are handled (2.4901ms)
✔ Adversarial: Zero-Width Characters (81.554065ms)
▶ Adversarial: Extremely Long Strings
  ✔ goal with 10,000 characters (25.778465ms)
  ✔ goal with 50,000 characters (55.151391ms)
  ✔ 100 constraints each with 1,000 characters (206.899277ms)
  ✔ single constraint with 100,000 characters (157.048698ms)
  ✔ deeply nested context object (2.029586ms)
  ✔ context with 1000 keys (2.637397ms)
✔ Adversarial: Extremely Long Strings (449.843321ms)
▶ Adversarial: Contradictory Constraints
  ✔ handles sync/async contradiction gracefully (3.726308ms)
  ✔ handles public/private contradiction gracefully (1.847535ms)
  ✔ handles sql/nosql contradiction gracefully (2.109666ms)
  ✔ handles rest/graphql contradiction gracefully (1.985133ms)
  ✔ handles monolith/microservice contradiction gracefully (1.932795ms)
  ✔ handles stateless/stateful contradiction gracefully (1.829941ms)
  ✔ handles online/offline contradiction gracefully (1.841503ms)
  ✔ handles single/multi-tenant contradiction gracefully (1.7969ms)
  ✔ handles open/closed-source contradiction gracefully (1.80265ms)
  ✔ handles real-time/batch contradiction gracefully (1.888322ms)
  ✔ multiple contradictions in same intent (3.245297ms)
  ✔ subtle contradiction: performance vs simplicity (1.861491ms)
✔ Adversarial: Contradictory Constraints (26.065012ms)
▶ Adversarial: List Ordering Attacks
  ✔ shuffled constraints produce identical bundle hash (6.310946ms)
  ✔ duplicates in different positions produce identical hash (3.301853ms)
  ✔ whitespace variations in constraints produce identical hash (4.737224ms)
  ✔ context key ordering is deterministic (0.272942ms)
✔ Adversarial: List Ordering Attacks (14.712352ms)
▶ Adversarial: Placeholder Density
  ✔ handles "TBD" in goal (1.766382ms)
  ✔ handles "TBD" in constraint (2.414449ms)
  ✔ handles "TODO" in goal (1.52506ms)
  ✔ handles "TODO" in constraint (1.650766ms)
  ✔ handles "FIXME" in goal (1.462382ms)
  ✔ handles "FIXME" in constraint (1.593248ms)
  ✔ handles "???" in goal (1.441283ms)
  ✔ handles "???" in constraint (1.544176ms)
  ✔ handles "..." in goal (1.449518ms)
  ✔ handles "..." in constraint (1.581876ms)
  ✔ handles "[TBD]" in goal (1.436915ms)
  ✔ handles "[TBD]" in constraint (1.62641ms)
  ✔ handles "(TBD)" in goal (1.441052ms)
  ✔ handles "(TBD)" in constraint (1.658501ms)
  ✔ handles "TO BE DETERMINED" in goal (1.689819ms)
  ✔ handles "TO BE DETERMINED" in constraint (2.534644ms)
  ✔ handles "TO DO" in goal (1.516544ms)
  ✔ handles "TO DO" in constraint (1.625889ms)
  ✔ handles "PLACEHOLDER" in goal (1.450841ms)
  ✔ handles "PLACEHOLDER" in constraint (1.578781ms)
  ✔ handles "XXX" in goal (1.434951ms)
  ✔ handles "XXX" in constraint (1.600692ms)
  ✔ handles "<<INSERT HERE>>" in goal (1.48209ms)
  ✔ handles "<<INSERT HERE>>" in constraint (1.620228ms)
  ✔ handles "<TBD>" in goal (1.412919ms)
  ✔ handles "<TBD>" in constraint (1.535991ms)
  ✔ handles "{TBD}" in goal (1.411127ms)
  ✔ handles "{TBD}" in constraint (1.530741ms)
  ✔ handles "NEEDS_WORK" in goal (1.413291ms)
  ✔ handles "NEEDS_WORK" in constraint (2.229872ms)
  ✔ goal consisting entirely of placeholders (0.14934ms)
  ✔ many placeholders increase entropy (3.69011ms)
  ✔ mixed real content and placeholders (2.416201ms)
  ✔ placeholder-like strings that are not placeholders (2.112222ms)
✔ Adversarial: Placeholder Density (57.455401ms)
▶ Adversarial Corpus Summary
  ✔ corpus contains expected number of fixtures (0.056025ms)
✔ Adversarial Corpus Summary (0.091672ms)
▶ Bundle Spec Invariants
  ▶ BS1: Schema Version Present
    ✔ simple intent has schema_version (14.827718ms)
    ✔ complex intent has schema_version (9.300412ms)
  ✔ BS1: Schema Version Present (24.744736ms)
  ▶ BS2: Hash Stability
    ✔ simple intent produces stable hash (9.270957ms)
    ✔ complex intent produces stable hash (9.537447ms)
    ✔ minimal intent produces stable hash (0.836058ms)
  ✔ BS2: Hash Stability (19.93191ms)
  ▶ BS3: Artifact Path Sorted
    ✔ simple intent outputs are sorted by path (4.297269ms)
    ✔ complex intent outputs are sorted by path (3.863435ms)
  ✔ BS3: Artifact Path Sorted (8.343767ms)
  ▶ BS4: Constraints Sorted
    ✔ simple intent constraints are sorted (2.695766ms)
    ✔ complex intent constraints are sorted (3.5619ms)
    ✔ constraint order in input does not affect sorting (0.506871ms)
  ✔ BS4: Constraints Sorted (6.887667ms)
  ▶ BS5: Questions Sorted
    ✔ simple intent questions are sorted (2.376817ms)
    ✔ complex intent questions are sorted (3.368066ms)
  ✔ BS5: Questions Sorted (5.814985ms)
  ▶ BS6: Terminal Nodes Sorted
    ✔ simple intent terminal nodes are sorted (2.405642ms)
    ✔ complex intent terminal nodes are sorted (3.395497ms)
  ✔ BS6: Terminal Nodes Sorted (5.871151ms)
  ▶ BS7: No Path Traversal
    ✔ simple intent has no path traversal (2.355727ms)
    ✔ complex intent has no path traversal (4.416773ms)
  ✔ BS7: No Path Traversal (6.85734ms)
  ▶ BS8: Canonical Idempotent
    ✔ simple intent is canonically idempotent (2.720492ms)
    ✔ complex intent is canonically idempotent (3.338321ms)
  ✔ BS8: Canonical Idempotent (6.135537ms)
  ▶ All Invariants Combined
    ✔ simple intent passes all invariants (2.888928ms)
    ✔ complex intent passes all invariants (3.256427ms)
    ✔ minimal intent passes all invariants (0.273503ms)
  ✔ All Invariants Combined (6.5159ms)
  ▶ Real Intents from Manifest
    ✔ loads manifest successfully (0.125215ms)
    ✔ all non-refusing intents pass bundle spec invariants (58.59578ms)
  ✔ Real Intents from Manifest (64.448847ms)
✔ Bundle Spec Invariants (156.184867ms)
▶ Canonical Serialization
  ✔ produces stable output for objects with different key insertion order (0.717425ms)
  ✔ produces stable output for nested objects (0.150833ms)
  ✔ handles arrays in index order (0.146846ms)
  ✔ round-trips through JSON parse (0.209303ms)
  ✔ rejects unsupported values (0.424476ms)
✔ Canonical Serialization (2.375315ms)
▶ Hash Stability
  ✔ produces identical hash for identical objects (0.494277ms)
  ✔ produces different hash for different objects (0.141495ms)
  ✔ produces consistent hash across multiple calls (0.664857ms)
✔ Hash Stability (1.47683ms)
▶ Transform Determinism
  ✔ produces identical bundle for simple intent (same process) (18.930823ms)
  ✔ produces identical bundle for complex intent (9.1501ms)
  ✔ produces identical bundle for minimal intent (0.700072ms)
  ✔ produces different bundle for different intents (9.713006ms)
  ✔ constraint order does not affect output (0.439955ms)
✔ Transform Determinism (39.310903ms)
▶ Validation Gates
  ✔ simple intent bundle passes all gates (3.922707ms)
  ✔ complex intent bundle passes all gates (4.402436ms)
  ✔ minimal intent bundle passes all gates (0.356539ms)
✔ Validation Gates (8.799592ms)
▶ Mutation Resistance
  ✔ deliberately randomized key insertion produces identical output (0.216075ms)
  ✔ repeated transforms produce identical bundle sequence (27.575174ms)
✔ Mutation Resistance (27.898862ms)
▶ Edge Cases
  ✔ handles empty constraints (0.260689ms)
  ✔ handles unicode in goal (5.523269ms)
  ✔ handles special characters in constraints (0.272992ms)
✔ Edge Cases (6.167126ms)
▶ Golden Hash Verification
  ✔ Golden Intent 001: User Authentication System (16.500104ms)
  ✔ Golden Intent 002: Hello World (0.641874ms)
  ✔ Golden Intent 003: REST API Server (7.712945ms)
✔ Golden Hash Verification (25.635677ms)
▶ Cross-Process Determinism
  ✔ can serialize and deserialize bundle for verification (4.715103ms)
✔ Cross-Process Determinism (4.933793ms)
▶ I1: Canonicalization Idempotence
  ✔ canonical(parse(canonical(x))) == canonical(x) for all seeds (3.94607ms)
  ✔ canonicalize is stable for objects with shuffled keys (0.664206ms)
  ✔ canonicalize round-trips through bytes (5.461162ms)
✔ I1: Canonicalization Idempotence (11.020367ms)
▶ I2: Normalization Idempotence
  ✔ normalizeIntent(normalizeIntent(x)) produces same result (2.400472ms)
  ✔ normalizeString is idempotent (0.452919ms)
  ✔ normalizeConstraint is idempotent (0.163697ms)
  ✔ normalizeConstraints is idempotent and sorted (1.74917ms)
✔ I2: Normalization Idempotence (5.075739ms)
▶ I3: Hash Stability
  ✔ canonicalHash produces same result across N runs (2.063029ms)
  ✔ bundle hash is stable across N transforms of same intent (95.335932ms)
  ✔ different intents produce different hashes (0.344576ms)
✔ I3: Hash Stability (97.920339ms)
▶ I4: Ordering Invariants
  ✔ outputs are always sorted by path (17.359355ms)
  ✔ unresolved_questions are sorted by (priority desc, id asc) (15.416071ms)
  ✔ terminal_nodes are sorted by id (14.469786ms)
  ✔ constraints within nodes are always sorted (15.33552ms)
✔ I4: Ordering Invariants (62.804673ms)
▶ I5: Validator Completeness
  ✔ empty goal always rejected (0.560721ms)
  ✔ missing required field (goal) always rejected (0.265007ms)
  ✔ contradictory constraints are detected and handled (40.728882ms)
  ✔ unicode normalization is consistent (NFC vs NFD) (0.105498ms)
  ✔ zero-width characters are handled consistently (32.915008ms)
  ✔ extremely long strings are handled without crash (10.542241ms)
  ✔ many constraints are handled deterministically (225.317147ms)
✔ I5: Validator Completeness (310.711154ms)
▶ Property Test Summary
  ✔ ran property tests across 100 seeds (0.110617ms)
✔ Property Test Summary (0.157776ms)
▶ Contradictory Constraints
  ✔ detects synchronous vs asynchronous contradiction (12.927424ms)
  ✔ detects public vs private contradiction (7.913211ms)
  ✔ detects required vs optional contradiction (0.251451ms)
  ✔ handles contradictions gracefully without crashing (1.16745ms)
✔ Contradictory Constraints (23.13073ms)
▶ Underspecified Intents
  ✔ handles minimal intent (just goal) (0.554821ms)
  ✔ detects high entropy for vague goals (0.134653ms)
  ✔ handles placeholder content (0.086984ms)
  ✔ handles TODO markers in constraints (0.086662ms)
✔ Underspecified Intents (1.108398ms)
▶ Adversarial Wording
  ✔ handles extremely long goal (28.024206ms)
  ✔ handles extremely long constraints (4.831911ms)
  ✔ handles many constraints (19.050447ms)
  ✔ handles special characters in goal (2.259067ms)
  ✔ handles unicode edge cases (4.086263ms)
  ✔ handles newlines and whitespace (0.389661ms)
  ✔ handles empty strings in constraints array (0.107141ms)
  ✔ handles duplicate constraints (0.039755ms)
✔ Adversarial Wording (59.083374ms)
▶ Malformed Inputs
  ✔ rejects empty goal (0.244058ms)
  ✔ rejects whitespace-only goal (0.067086ms)
  ✔ handles constraints as undefined (0.038222ms)
  ✔ handles context as undefined (0.025679ms)
✔ Malformed Inputs (0.434866ms)
▶ Boundary Conditions
  ✔ handles single character goal (0.206147ms)
  ✔ produces deterministic output for near-identical inputs (4.349497ms)
  ✔ handles maximum decomposition depth gracefully (3.245927ms)
  ✔ handles zero entropy case (0.264446ms)
✔ Boundary Conditions (8.162989ms)
▶ Security Edge Cases
  ✔ handles potential injection in goal (2.194195ms)
  ✔ handles potential path traversal in constraints (0.18654ms)
  ✔ handles extremely nested context (0.18155ms)
✔ Security Edge Cases (2.646042ms)
▶ Bundle CLI Functions
  ▶ bundle-verify behavior
    ✔ returns ok:true for valid bundle (6.759336ms)
    ✔ returns ok:false with violations for invalid bundle (1.763247ms)
    ✔ output is deterministic (1.138195ms)
  ✔ bundle-verify behavior (10.339691ms)
  ▶ bundle-summarize behavior
    ✔ produces canonical JSON summary for valid bundle (1.541521ms)
    ✔ summary includes all required fields (0.940223ms)
    ✔ output keys are sorted (canonical) (0.959219ms)
    ✔ output is byte-identical across runs (0.726021ms)
  ✔ bundle-summarize behavior (4.482716ms)
  ▶ Error handling patterns
    ✔ verify handles malformed input gracefully (0.305643ms)
    ✔ verify handles array input (0.094828ms)
    ✔ verify handles primitive input (0.092594ms)
  ✔ Error handling patterns (0.642975ms)
✔ Bundle CLI Functions (15.859372ms)
▶ Verifier Report Ingestion
  ▶ validateFolderName
    ✔ accepts valid folder names (5.926996ms)
    ✔ accepts folder names with underscores in verifier_id (1.675172ms)
    ✔ accepts folder names with hyphens in verifier_id (1.475056ms)
    ✔ rejects invalid format (0.878878ms)
    ✔ rejects missing date (0.481704ms)
    ✔ rejects invalid date (0.434275ms)
  ✔ validateFolderName (11.72561ms)
  ▶ validateRequiredFiles
    ✔ passes when VERIFIER_REPORT.md exists (2.646783ms)
    ✔ fails when VERIFIER_REPORT.md is missing (1.595743ms)
  ✔ validateRequiredFiles (4.606078ms)
  ▶ validateJsonSchema
    ✔ accepts valid JSON with all required fields (1.82383ms)
    ✔ rejects JSON missing required fields (1.085215ms)
    ✔ rejects invalid schema_version (2.151154ms)
    ✔ rejects malformed JSON (1.13569ms)
  ✔ validateJsonSchema (6.480784ms)
  ▶ parseMarkdownReport
    ✔ parses valid markdown report correctly (1.142643ms)
    ✔ fails with stable error when verifier_kind is missing (0.706315ms)
    ✔ detects version mismatch (0.92247ms)
    ✔ reports missing verifier_kind with stable error message (0.503414ms)
    ✔ reports other missing fields after verifier_kind present (0.776516ms)
  ✔ parseMarkdownReport (4.369895ms)
  ▶ Index Entry Management
    ✔ formats table row correctly (0.720532ms)
    ✔ parses existing entries from index content (0.603332ms)
    ✔ detects duplicates correctly (0.302788ms)
  ✔ Index Entry Management (1.838157ms)
  ▶ Valid submission with JSON passes and updates index deterministically
    ✔ parses and validates correctly (1.51429ms)
  ✔ Valid submission with JSON passes and updates index deterministically (1.607284ms)
  ▶ Valid submission without JSON passes
    ✔ parses markdown-only submission correctly (0.753082ms)
  ✔ Valid submission without JSON passes (0.839234ms)
  ▶ Invalid JSON fails with stable error message
    ✔ produces consistent error for invalid JSON (1.003763ms)
  ✔ Invalid JSON fails with stable error message (1.087389ms)
✔ Verifier Report Ingestion (33.187069ms)
▶ Pack CLI
  ▶ Valid Packs
    ✔ returns ok:true for valid_pack_bundle (34.305436ms)
    ✔ returns ok:true for valid_pack_clarify (26.968607ms)
    ✔ returns ok:true for valid_pack_refuse (25.589751ms)
    ✔ returns ok:true for valid_pack_full (23.711519ms)
  ✔ Valid Packs (111.402873ms)
  ▶ Invalid Packs
    ✔ returns exit 1 for missing run.json (19.460096ms)
    ✔ returns exit 1 for missing bundle.json (19.221198ms)
    ✔ returns exit 1 for unknown file (18.647011ms)
    ✔ returns exit 1 for hash mismatch (20.891219ms)
  ✔ Invalid Packs (78.601288ms)
  ▶ Determinism
    ✔ produces byte-identical output across runs (valid) (40.297894ms)
    ✔ produces byte-identical output across runs (invalid) (36.589169ms)
    ✔ violations are sorted deterministically (21.149464ms)
  ✔ Determinism (98.252732ms)
  ▶ Error Handling
    ✔ returns exit 2 for non-existent directory (18.12976ms)
    ✔ returns exit 2 for file instead of directory (18.89213ms)
  ✔ Error Handling (37.180147ms)
  ▶ Options
    ✔ --no-deep skips deep validation (19.380556ms)
    ✔ --no-refs skips hash verification (17.735952ms)
    ✔ --help shows usage (16.846884ms)
  ✔ Options (54.220635ms)
  ▶ Reference Checks
    ✔ includes reference_checks in success output (18.965327ms)
  ✔ Reference Checks (19.090231ms)
✔ Pack CLI (399.283652ms)
▶ Patch CLI
  ▶ Valid Patch
    ✔ returns ok:true for valid patch (30.900801ms)
  ✔ Valid Patch (31.482212ms)
  ▶ Invalid Patches
    ✔ returns violations for absolute path (23.320695ms)
    ✔ returns violations for traversal path (20.896459ms)
    ✔ returns violations for duplicate paths (21.754518ms)
    ✔ returns violations for binary content (19.689315ms)
  ✔ Invalid Patches (86.023097ms)
  ▶ Determinism
    ✔ produces byte-identical output across runs (valid) (36.463714ms)
    ✔ produces byte-identical output across runs (invalid) (34.876647ms)
    ✔ violations are sorted deterministically (18.865971ms)
  ✔ Determinism (90.554274ms)
  ▶ Error Handling
    ✔ returns exit 1 for missing file (15.830929ms)
    ✔ returns exit 2 for invalid JSON (34.183167ms)
  ✔ Error Handling (50.17595ms)
  ▶ Options
    ✔ --max-bytes enforces limit (17.373723ms)
    ✔ --help shows usage (16.498742ms)
  ✔ Options (34.032795ms)
✔ Patch CLI (293.80589ms)
▶ Reference Release Tagging
  ▶ validateRelease
    ✔ accepts valid release format (6.166684ms)
    ✔ rejects invalid release format (0.928702ms)
  ✔ validateRelease (7.720228ms)
  ▶ validateDate
    ✔ accepts valid date format (1.724333ms)
    ✔ rejects invalid date format (0.614172ms)
    ✔ requires date when not dry-run (0.607199ms)
    ✔ allows missing date in dry-run mode (0.526397ms)
  ✔ validateDate (3.883954ms)
  ▶ parseMarkdownForVerification
    ✔ parses internal verifier_kind (1.243562ms)
    ✔ parses independent verifier_kind (0.782838ms)
    ✔ returns null for missing verifier_kind (1.486027ms)
  ✔ parseMarkdownForVerification (3.78585ms)
  ▶ loadInternalReports
    ✔ loads only internal reports from fixture (1.495254ms)
    ✔ returns empty array when only independent reports exist (1.273388ms)
    ✔ returns empty array when no verified folder (0.42673ms)
  ✔ loadInternalReports (3.383996ms)
  ▶ checkIndexAlreadyRecorded
    ✔ returns false when Reference Tag not recorded (1.092549ms)
    ✔ returns true when Reference Tag already recorded (0.344836ms)
  ✔ checkIndexAlreadyRecorded (1.554505ms)
  ▶ updateIndexWithReferenceTag
    ✔ adds Reference Tag row to INDEX.md (0.64522ms)
    ✔ produces deterministic output (0.498675ms)
  ✔ updateIndexWithReferenceTag (1.263219ms)
  ▶ createStubGitHelper
    ✔ returns configured commit for rev-parse (0.439784ms)
    ✔ reports tag existence correctly (0.882175ms)
  ✔ createStubGitHelper (1.46671ms)
  ▶ Threshold not met
    ✔ returns exit code 2 when no internal reports exist (0.576801ms)
    ✔ independent-only reports do NOT count toward reference threshold (0.635823ms)
  ✔ Threshold not met (1.324074ms)
  ▶ Threshold met dry-run
    ✔ outputs JSON with expected reference tag name (0.642255ms)
  ✔ Threshold met dry-run (0.724249ms)
  ▶ Already recorded
    ✔ refuses with stable message when INDEX.md already has Reference Tag (0.499897ms)
  ✔ Already recorded (0.593604ms)
  ▶ Determinism
    ✔ produces stable error messages (0.665839ms)
    ✔ produces stable report loading order (0.860534ms)
    ✔ dry-run JSON output is byte-identical across runs (0.963667ms)
  ✔ Determinism (2.654478ms)
✔ Reference Release Tagging (29.496808ms)
▶ Verified Release Tagging
  ▶ validateRelease
    ✔ accepts valid release format (3.354461ms)
    ✔ rejects invalid release format (0.988454ms)
  ✔ validateRelease (4.913314ms)
  ▶ validateDate
    ✔ accepts valid date format (1.288938ms)
    ✔ rejects invalid date format (0.514555ms)
    ✔ requires date when not dry-run (0.497703ms)
    ✔ allows missing date in dry-run mode (0.334086ms)
  ✔ validateDate (2.93254ms)
  ▶ validateThreshold
    ✔ accepts valid threshold (0.502432ms)
    ✔ rejects invalid threshold (2.50071ms)
  ✔ validateThreshold (3.434851ms)
  ▶ parseMarkdownForVerification
    ✔ parses valid verified report with verifier_kind (1.381731ms)
    ✔ parses internal verifier_kind (0.561723ms)
    ✔ returns null for missing verifier_kind (0.369313ms)
    ✔ detects failed result (0.379552ms)
    ✔ handles missing fields (0.359875ms)
    ✔ handles placeholder fields (0.50675ms)
  ✔ parseMarkdownForVerification (3.923859ms)
  ▶ loadVerifiedReports
    ✔ loads valid reports from fixture with verifier_kind (1.388173ms)
    ✔ returns empty array when no verified folder (0.490059ms)
    ✔ excludes reports with missing required fields (0.622617ms)
    ✔ loads internal reports when present (0.489228ms)
  ✔ loadVerifiedReports (3.160417ms)
  ▶ checkIndexAlreadyRecorded
    ✔ returns false when not recorded (1.204048ms)
    ✔ returns true when already recorded (0.390833ms)
  ✔ checkIndexAlreadyRecorded (1.690761ms)
  ▶ updateIndexWithVerifiedTag
    ✔ adds Verified Tag row to INDEX.md (0.553708ms)
    ✔ produces deterministic output (0.530956ms)
  ✔ updateIndexWithVerifiedTag (1.179151ms)
  ▶ createStubGitHelper
    ✔ returns configured commit for rev-parse (0.673693ms)
    ✔ reports tag existence correctly (0.439304ms)
  ✔ createStubGitHelper (1.236779ms)
  ▶ Threshold not met
    ✔ returns exit code 2 with exact error string for no reports (0.450044ms)
    ✔ internal-only reports do NOT count toward verified threshold (0.423024ms)
  ✔ Threshold not met (0.972494ms)
  ▶ Threshold met dry-run
    ✔ outputs JSON with expected tag name and verifier_kind counts (0.675347ms)
  ✔ Threshold met dry-run (0.743865ms)
  ▶ Invalid report with missing fields
    ✔ tool refuses to count reports with missing OS/node/npm (1.021696ms)
  ✔ Invalid report with missing fields (1.092549ms)
  ▶ Already verified recorded
    ✔ refuses with stable message when INDEX.md already has Verified Tag (0.385773ms)
  ✔ Already verified recorded (0.449062ms)
  ▶ Determinism
    ✔ produces stable error messages (0.456005ms)
    ✔ produces stable report loading order (0.553668ms)
    ✔ dry-run JSON output is byte-identical across runs (0.907602ms)
  ✔ Determinism (2.044474ms)
✔ Verified Release Tagging (28.430869ms)
ℹ tests 645
ℹ suites 199
ℹ pass 645
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 736.302453
