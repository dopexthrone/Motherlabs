
> context-engine-kernel@0.1.0 test
> node --test dist/tests/*.test.js dist/harness/tests/*.test.js dist/tools/tests/*.test.js dist/consumer/tests/*.test.js

▶ Bundle Summary
  ▶ Outcome Detection
    ✔ detects BUNDLE outcome for complete status (5.368454ms)
    ✔ detects CLARIFY outcome for incomplete status (0.967995ms)
    ✔ detects REFUSE outcome for error status (0.785573ms)
  ✔ Outcome Detection (7.651785ms)
  ▶ Field Extraction
    ✔ extracts schema_version correctly (1.182056ms)
    ✔ computes bundle_hash (0.60852ms)
    ✔ counts artifacts correctly (0.588093ms)
    ✔ counts unresolved questions correctly (0.640842ms)
    ✔ counts terminal nodes correctly (0.60237ms)
  ✔ Field Extraction (3.975032ms)
  ▶ Sorting
    ✔ artifact_paths are sorted lexicographically (2.785883ms)
    ✔ question_ids are sorted by priority desc, id asc (0.77322ms)
    ✔ terminal_node_ids are sorted lexicographically (0.68811ms)
  ✔ Sorting (4.477855ms)
  ▶ Determinism
    ✔ produces identical summary for same bundle (1.918667ms)
    ✔ summary is byte-identical across multiple runs (3.357223ms)
    ✔ canonical JSON has sorted keys (1.298404ms)
  ✔ Determinism (6.862606ms)
  ▶ Edge Cases
    ✔ handles bundle with no outputs (0.875461ms)
    ✔ handles bundle with no unresolved questions (1.134907ms)
    ✔ handles bundle with no terminal nodes (1.04547ms)
  ✔ Edge Cases (3.240134ms)
✔ Bundle Summary (26.673696ms)
▶ Bundle Verification
  ▶ Valid Bundles
    ✔ accepts valid BUNDLE outcome (4.533028ms)
    ✔ accepts valid CLARIFY outcome (0.868879ms)
    ✔ accepts valid REFUSE outcome (0.592972ms)
  ✔ Valid Bundles (6.58766ms)
  ▶ Invalid Bundles
    ✔ rejects bundle with unsorted output paths (BS3) (1.55747ms)
    ✔ rejects bundle with path traversal (BS7) (0.924934ms)
    ✔ rejects non-object bundle (0.162043ms)
    ✔ rejects null bundle (0.096421ms)
    ✔ rejects bundle with missing schema_version (BS1) (0.133199ms)
    ✔ rejects bundle with empty schema_version (BS1) (0.103654ms)
  ✔ Invalid Bundles (3.307852ms)
  ▶ Violation Ordering
    ✔ violations are sorted by rule_id then path (0.760265ms)
  ✔ Violation Ordering (0.836599ms)
  ▶ Determinism
    ✔ produces identical result for same input (3.815022ms)
    ✔ violations are byte-identical across runs (0.638888ms)
  ✔ Determinism (4.604983ms)
✔ Bundle Verification (15.784411ms)
▶ Patch Verification
  ▶ PS1: Schema Version Present
    ✔ valid schema version passes (0.582812ms)
    ✔ missing schema version fails (0.120125ms)
    ✔ empty schema version fails (0.102842ms)
  ✔ PS1: Schema Version Present (1.163401ms)
  ▶ PS2: Op Enum Valid
    ✔ create op passes (0.102211ms)
    ✔ modify op passes (0.067937ms)
    ✔ delete op passes (0.130464ms)
    ✔ invalid op fails (0.173094ms)
  ✔ PS2: Op Enum Valid (0.615414ms)
  ▶ PS3: Path Relative Only
    ✔ relative path passes (0.141375ms)
    ✔ absolute path fails (5.742125ms)
    ✔ Windows drive path fails (0.273383ms)
  ✔ PS3: Path Relative Only (6.374691ms)
  ▶ PS4: No Path Traversal
    ✔ normal path passes (0.732753ms)
    ✔ traversal path fails (7.095542ms)
    ✔ backslash path fails (0.215113ms)
    ✔ dot-slash path fails (0.112351ms)
    ✔ double-slash path fails (0.081353ms)
    ✔ trailing slash path fails (0.061185ms)
  ✔ PS4: No Path Traversal (8.546392ms)
  ▶ PS5: No Duplicate Targets
    ✔ unique paths pass (0.080731ms)
    ✔ duplicate paths fail (2.611947ms)
  ✔ PS5: No Duplicate Targets (2.913211ms)
  ▶ PS6: Text Only UTF-8
    ✔ valid UTF-8 passes (0.153929ms)
    ✔ null bytes fail (0.814598ms)
    ✔ delete with content fails (0.138139ms)
    ✔ create without content fails (0.079559ms)
  ✔ PS6: Text Only UTF-8 (1.321157ms)
  ▶ PS7: Max Bytes Enforced
    ✔ within limit passes (0.081814ms)
    ✔ exceeds limit fails (0.087444ms)
    ✔ mismatched total_bytes fails (0.076393ms)
  ✔ PS7: Max Bytes Enforced (0.33077ms)
  ▶ PS8: Sorting Canonical
    ✔ properly sorted passes (0.099347ms)
    ✔ unsorted by order fails (0.084729ms)
    ✔ unsorted by path (same order) fails (0.079139ms)
  ✔ PS8: Sorting Canonical (0.338284ms)
  ▶ PS9: No Symlink Intent
    ✔ symlink op fails (0.097242ms)
  ✔ PS9: No Symlink Intent (0.144531ms)
  ▶ PS10: Stable Violations
    ✔ violations are sorted by rule_id then path (0.334146ms)
  ✔ PS10: Stable Violations (0.392566ms)
  ▶ Fixture: Valid Patch
    ✔ valid fixture passes all checks (8.036156ms)
  ✔ Fixture: Valid Patch (8.16102ms)
  ▶ Schema Errors
    ✔ null input fails (0.224211ms)
    ✔ array input fails (0.096561ms)
    ✔ missing required fields fails (0.07982ms)
  ✔ Schema Errors (0.512931ms)
✔ Patch Verification (31.5137ms)
▶ Evidence Spec Invariants
  ▶ EV1: Proposal Hash Integrity
    ✔ valid evidence has valid proposal_hash (0.499346ms)
    ✔ rejects missing proposal_hash (0.280646ms)
    ✔ rejects invalid hash format (0.85895ms)
    ✔ accepts sha256-prefixed hash (0.09576ms)
    ✔ accepts bare hex hash (0.07981ms)
  ✔ EV1: Proposal Hash Integrity (2.273713ms)
  ▶ EV2: Action Results Consistency
    ✔ valid action results pass (0.182412ms)
    ✔ rejects missing action_id (0.128571ms)
    ✔ rejects invalid status (0.083717ms)
    ✔ rejects negative duration_ms (0.295163ms)
    ✔ accepts all valid status types (0.144601ms)
  ✔ EV2: Action Results Consistency (1.030532ms)
  ▶ EV3: Test Results Validity
    ✔ valid test results pass (0.123161ms)
    ✔ rejects missing test_id (0.103635ms)
    ✔ rejects non-boolean passed (0.059862ms)
    ✔ rejects non-string actual (0.089177ms)
  ✔ EV3: Test Results Validity (0.467226ms)
  ▶ EV4: Status Consistency
    ✔ complete status with successful actions passes (0.122209ms)
    ✔ failed status with failures passes (0.06388ms)
    ✔ partial status passes (0.064391ms)
    ✔ rejects complete status with failures (0.071454ms)
    ✔ rejects invalid status value (0.052699ms)
  ✔ EV4: Status Consistency (0.459932ms)
  ▶ EV5: Evidence Hash Determinism
    ✔ hash is deterministic for same evidence (0.494848ms)
    ✔ hash is same regardless of ephemeral fields (0.110407ms)
    ✔ hash differs for different core fields (0.110767ms)
    ✔ hash is deterministic for complex evidence (5.434038ms)
  ✔ EV5: Evidence Hash Determinism (6.285553ms)
  ▶ All Invariants Combined
    ✔ valid evidence passes all invariants (0.212429ms)
    ✔ failed evidence passes all invariants (0.130064ms)
    ✔ partial evidence passes all invariants (0.098214ms)
  ✔ All Invariants Combined (0.554409ms)
  ▶ EvidenceCore Computation
    ✔ computeEvidenceCore excludes ephemeral fields (0.089067ms)
    ✔ computeEvidenceCore sorts action_results by action_id (0.097953ms)
    ✔ computeEvidenceCore sorts test_results by test_id (0.098424ms)
  ✔ EvidenceCore Computation (0.363992ms)
✔ Evidence Spec Invariants (11.855827ms)
▶ Harness: Plan-Only Mode
  ✔ processes simple intent without execution (8.363079ms)
  ✔ handles clarify result for vague intent (10.724355ms)
  ✔ produces deterministic results for same intent (2.621505ms)
✔ Harness: Plan-Only Mode (22.619515ms)
▶ Harness: Execute-Sandbox Mode
  ✔ executes proposal in sandbox and captures evidence (5.458423ms)
  ✔ sandbox never writes outside sandbox dir (3.535648ms)
  ✔ respects policy timeout (0.179356ms)
✔ Harness: Execute-Sandbox Mode (9.440829ms)
▶ Harness: Policy Profiles
  ✔ strict policy has most restrictive settings (0.167564ms)
  ✔ default policy is balanced (0.07967ms)
  ✔ dev policy is relaxed (0.398136ms)
  ✔ policy is included in result (1.845049ms)
✔ Harness: Policy Profiles (2.706414ms)
▶ Harness: Kernel Authority
  ✔ kernel generates bundle (harness does not) (0.965219ms)
  ✔ kernel validates evidence (harness does not decide) (1.657187ms)
✔ Harness: Kernel Authority (2.743073ms)
▶ Harness: Result Structure
  ✔ result has all required fields (1.021084ms)
  ✔ timestamps are valid ISO 8601 UTC (1.591984ms)
✔ Harness: Result Structure (2.75731ms)
▶ Ledger Spec Invariants
  ▶ LD1: One Entry Per Line
    ✔ valid single entry parses correctly (0.722294ms)
    ✔ valid multiple entries parse correctly (0.171161ms)
    ✔ rejects invalid JSON (0.329238ms)
    ✔ rejects missing required fields (0.142147ms)
    ✔ rejects invalid result_kind (0.167995ms)
    ✔ rejects invalid mode (0.13352ms)
    ✔ rejects invalid policy (0.126036ms)
    ✔ accepts all valid result_kind values (0.16537ms)
    ✔ accepts all valid mode values (0.110117ms)
    ✔ accepts all valid policy values (0.155412ms)
  ✔ LD1: One Entry Per Line (2.887373ms)
  ▶ LD2: Monotonic Timestamps
    ✔ ascending timestamps pass (0.164278ms)
    ✔ equal timestamps pass (0.061916ms)
    ✔ descending timestamps fail (0.095359ms)
    ✔ single entry passes (0.04263ms)
    ✔ empty array passes (0.048802ms)
  ✔ LD2: Monotonic Timestamps (0.546665ms)
  ▶ LD3: Unique Run IDs
    ✔ unique run_ids pass (0.108544ms)
    ✔ duplicate run_ids fail (0.110376ms)
    ✔ single entry passes (0.03722ms)
    ✔ empty array passes (0.027822ms)
  ✔ LD3: Unique Run IDs (0.355616ms)
  ▶ LD4: Valid Content Hashes
    ✔ valid hashes pass (0.155432ms)
    ✔ null bundle_sha256 passes (0.059913ms)
    ✔ invalid intent_sha256 fails (0.103815ms)
    ✔ invalid bundle_sha256 fails (0.086342ms)
    ✔ hash without sha256 prefix fails (0.073257ms)
    ✔ hash with wrong length fails (0.05356ms)
  ✔ LD4: Valid Content Hashes (0.657122ms)
  ▶ All Invariants Combined
    ✔ valid ledger passes all checks (0.124233ms)
    ✔ empty ledger passes (0.041328ms)
    ✔ single valid entry passes (0.055194ms)
  ✔ All Invariants Combined (0.295123ms)
  ▶ serializeLedgerEntry
    ✔ produces canonical JSON (0.087384ms)
    ✔ produces valid JSON (0.053089ms)
    ✔ serialized entry passes invariant checks (0.050675ms)
  ✔ serializeLedgerEntry (0.257573ms)
  ▶ createLedgerEntry
    ✔ creates valid entry from HarnessRunResult (0.16016ms)
    ✔ created entry passes invariant checks (0.128631ms)
    ✔ handles null bundle correctly (0.070983ms)
  ✔ createLedgerEntry (0.430627ms)
  ▶ Content Hash Validation
    ✔ isValidContentHash accepts valid hashes (0.12252ms)
    ✔ isValidContentHash rejects invalid hashes (0.184185ms)
  ✔ Content Hash Validation (0.428934ms)
✔ Ledger Spec Invariants (6.949689ms)
▶ Policy Spec Invariants
  ▶ PL1: Profile Enum
    ✔ strict profile has valid name (0.45881ms)
    ✔ default profile has valid name (0.110317ms)
    ✔ dev profile has valid name (0.080541ms)
    ✔ listPolicies returns all three profiles (0.562044ms)
  ✔ PL1: Profile Enum (1.798311ms)
  ▶ PL2: Resolved Complete
    ✔ strict profile is fully populated (0.163566ms)
    ✔ default profile is fully populated (0.305984ms)
    ✔ dev profile is fully populated (0.098214ms)
    ✔ all profiles have no undefined values (0.158637ms)
  ✔ PL2: Resolved Complete (0.947637ms)
  ▶ PL3: Limits Within Bounds
    ✔ strict profile limits are within bounds (3.615027ms)
    ✔ default profile limits are within bounds (0.22395ms)
    ✔ dev profile limits are within bounds (0.144431ms)
    ✔ strict has most restrictive timeout (0.09615ms)
    ✔ strict has most restrictive file limits (0.130405ms)
    ✔ strict has most restrictive byte limits (0.062687ms)
  ✔ PL3: Limits Within Bounds (4.523009ms)
  ▶ PL4: Model Mode Strict/Default
    ✔ strict allows only none mode (0.119424ms)
    ✔ default allows only none mode (0.048942ms)
    ✔ strict rejects record with PL4 error (0.361287ms)
    ✔ strict rejects replay with PL4 error (0.123411ms)
    ✔ default rejects record with PL4 error (0.101601ms)
    ✔ default rejects replay with PL4 error (0.110137ms)
    ✔ error message is stable and deterministic (0.10126ms)
  ✔ PL4: Model Mode Strict/Default (1.127985ms)
  ▶ PL5: Model Mode Dev
    ✔ dev allows all modes (0.111469ms)
    ✔ dev none mode requires no recording path (0.039594ms)
    ✔ dev record mode requires recording path (0.098274ms)
    ✔ dev replay mode requires recording path (0.092724ms)
    ✔ dev record mode with path passes (0.054802ms)
    ✔ dev replay mode with path passes (0.052709ms)
    ✔ PL5 error message is stable (0.122589ms)
  ✔ PL5: Model Mode Dev (0.71476ms)
  ▶ PL6: Sandbox Constraints
    ✔ strict allows only specified commands (0.180037ms)
    ✔ default allows specified commands (0.058149ms)
    ✔ dev allows all commands (empty list) (0.048971ms)
    ✔ strict allows only specified write roots (0.096732ms)
    ✔ default allows more write roots (0.156403ms)
    ✔ dev allows all write paths (empty list) (0.121998ms)
  ✔ PL6: Sandbox Constraints (0.801022ms)
  ▶ PL7: Evidence Policy Binding
    ✔ harness result includes full policy object (20.824701ms)
    ✔ policy in result matches resolved policy exactly (3.197044ms)
    ✔ policy binding is deterministic across runs (1.401277ms)
  ✔ PL7: Evidence Policy Binding (25.648884ms)
  ▶ Deterministic Resolution
    ✔ loadPolicy returns identical object for same profile (0.120176ms)
    ✔ loadPolicy is byte-identical across multiple calls (0.236944ms)
    ✔ profile values match documented spec (0.130715ms)
  ✔ Deterministic Resolution (0.59185ms)
  ▶ All Invariants Combined
    ✔ strict profile passes all invariants (0.097252ms)
    ✔ default profile passes all invariants (0.045305ms)
    ✔ dev profile passes all invariants (0.045536ms)
  ✔ All Invariants Combined (0.291897ms)
✔ Policy Spec Invariants (37.093009ms)
▶ Run Spec Invariants
  ▶ RS1: Schema Version Present
    ✔ valid schema version passes (0.500118ms)
    ✔ missing schema version fails (0.312536ms)
    ✔ empty schema version fails (0.110256ms)
  ✔ RS1: Schema Version Present (1.416406ms)
  ▶ RS2: Outcome Coverage
    ✔ BUNDLE outcome passes (0.689973ms)
    ✔ CLARIFY outcome passes (0.156784ms)
    ✔ REFUSE outcome passes (0.090109ms)
    ✔ invalid outcome fails (0.123952ms)
  ✔ RS2: Outcome Coverage (1.251847ms)
  ▶ RS3: Outcome-Field Consistency
    ✔ BUNDLE with non-null bundle passes (0.684483ms)
    ✔ BUNDLE with null bundle fails (0.338694ms)
    ✔ BUNDLE with clarify_questions fails (0.280857ms)
    ✔ CLARIFY with clarify_questions passes (0.093476ms)
    ✔ CLARIFY without clarify_questions fails (0.124122ms)
    ✔ REFUSE with refuse_reason passes (0.057418ms)
    ✔ REFUSE without refuse_reason fails (0.135574ms)
  ✔ RS3: Outcome-Field Consistency (1.955095ms)
  ▶ RS4: Reference Integrity
    ✔ valid hashes pass (0.164017ms)
    ✔ invalid intent hash fails (0.095759ms)
    ✔ invalid bundle hash fails (0.085921ms)
    ✔ empty bundle_id fails (0.081122ms)
  ✔ RS4: Reference Integrity (0.585056ms)
  ▶ RS5: Policy Binding
    ✔ matching policy passes (0.305353ms)
    ✔ modified policy fails (0.210004ms)
  ✔ RS5: Policy Binding (0.604373ms)
  ▶ RS6: No Leak
    ✔ relative path passes (0.112151ms)
    ✔ absolute path fails (0.14918ms)
    ✔ Windows absolute path fails (0.10143ms)
  ✔ RS6: No Leak (0.434826ms)
  ▶ RS7: Canonical Output
    ✔ valid result is canonically stable (0.1707ms)
    ✔ result with arrays is canonically stable (0.09641ms)
  ✔ RS7: Canonical Output (0.324889ms)
  ▶ RS8: Decision Consistency
    ✔ validated_by_kernel true passes (0.108574ms)
    ✔ validated_by_kernel false fails (0.102993ms)
    ✔ CLARIFY with accepted true fails (0.09615ms)
    ✔ REFUSE with accepted true fails (0.082525ms)
  ✔ RS8: Decision Consistency (0.467857ms)
  ▶ All Invariants Combined
    ✔ valid BUNDLE result passes all checks (0.16517ms)
    ✔ valid CLARIFY result passes all checks (0.193322ms)
    ✔ valid REFUSE result passes all checks (0.108473ms)
  ✔ All Invariants Combined (0.53893ms)
  ▶ Integration: Real Harness Run
    ✔ runHarness produces spec-compliant result (26.528945ms)
    ✔ runHarness uses sanitized intent path (1.80295ms)
    ✔ runHarness produces canonical output (0.917079ms)
  ✔ Integration: Real Harness Run (29.45503ms)
✔ Run Spec Invariants (37.652217ms)
▶ Security: Symlink Escape
  ✔ refuses to follow symlinks in output directory (8.901698ms)
  ✔ refuses to follow directory symlinks (1.868403ms)
✔ Security: Symlink Escape (11.506732ms)
▶ Security: Path Traversal
  ✔ validates isPathSafe correctly (2.031768ms)
  ✔ rejects absolute paths in output (1.188809ms)
✔ Security: Path Traversal (3.415924ms)
▶ Security: File Spam
  ✔ respects max_output_files limit (52.355693ms)
  ✔ respects max_total_output_bytes limit (29.588661ms)
✔ Security: File Spam (82.238024ms)
▶ Security: Deep Recursion
  ✔ limits directory traversal depth (4.999914ms)
  ✔ allows directories within depth limit (2.488816ms)
✔ Security: Deep Recursion (7.703652ms)
▶ Security: Combined Attacks
  ✔ handles multiple security issues simultaneously (9.542971ms)
✔ Security: Combined Attacks (9.671131ms)
▶ MockModelAdapter
  ✔ should return configured response for exact prompt (2.751068ms)
  ✔ should throw AdapterError for unmatched prompt in strict mode (0.665758ms)
  ✔ should echo prompt in echo mode (0.158457ms)
  ✔ should return fixed content in fixed mode (0.233027ms)
  ✔ should match substring patterns (0.152285ms)
  ✔ should record interactions when enabled (0.408406ms)
  ✔ should export recording session (0.259477ms)
  ✔ should report ready state correctly (0.267261ms)
  ✔ should have correct adapter_id and model_id (0.321192ms)
  ✔ should estimate tokens from content length (0.42147ms)
✔ MockModelAdapter (7.064454ms)
▶ RecordingModelAdapter
  ✔ should record interactions from delegate (0.64034ms)
  ✔ should delegate transform calls correctly (0.12252ms)
  ✔ should compute stats correctly (0.201357ms)
  ✔ should respect max_interactions limit (0.178604ms)
  ✔ should redact prompts when include_prompts is false (0.100629ms)
  ✔ should delegate isReady and shutdown (0.087554ms)
✔ RecordingModelAdapter (1.526742ms)
▶ ReplayModelAdapter
  ✔ should replay recorded response by prompt hash (0.268564ms)
  ✔ should throw for unrecorded prompt in strict mode (0.147767ms)
  ✔ should return empty content for unrecorded prompt in non-strict mode (0.08539ms)
  ✔ should enforce sequence order in sequential mode (0.094858ms)
  ✔ should fail in sequential mode if prompts are out of order (0.146886ms)
  ✔ should report recording count (0.161813ms)
  ✔ should check hasRecording correctly (0.108874ms)
  ✔ should always be ready (0.120926ms)
✔ ReplayModelAdapter (1.404794ms)
▶ Record and Replay Integration
  ✔ should produce identical results when replaying recorded session (0.664896ms)
  ✔ should create adapter from recording session (0.250941ms)
✔ Record and Replay Integration (0.990567ms)
▶ Adapter Determinism
  ✔ should produce identical results across multiple runs (0.431519ms)
  ✔ should produce same hash for same prompt regardless of context metadata (0.113793ms)
✔ Adapter Determinism (0.627967ms)
▶ Adversarial: Unicode Normalization
  ✔ A-umlaut: NFC and NFD produce identical normalized output (1.25323ms)
  ✔ O-umlaut: NFC and NFD produce identical normalized output (0.12253ms)
  ✔ U-umlaut: NFC and NFD produce identical normalized output (0.096742ms)
  ✔ e-acute: NFC and NFD produce identical normalized output (0.081262ms)
  ✔ n-tilde: NFC and NFD produce identical normalized output (0.070673ms)
  ✔ c-cedilla: NFC and NFD produce identical normalized output (0.062307ms)
  ✔ a-grave: NFC and NFD produce identical normalized output (0.061415ms)
  ✔ mixed NFC/NFD in constraints produce identical hashes (0.688732ms)
  ✔ Korean Hangul syllables (precomposed vs jamo) (19.446457ms)
✔ Adversarial: Unicode Normalization (22.811886ms)
▶ Adversarial: Zero-Width Characters
  ✔ ZWSP at start of goal is handled (5.182206ms)
  ✔ ZWSP at end of goal is handled (4.079157ms)
  ✔ ZWSP in middle of goal is handled (4.084768ms)
  ✔ multiple ZWSP in constraints are handled (4.457056ms)
  ✔ ZWNJ at start of goal is handled (4.187811ms)
  ✔ ZWNJ at end of goal is handled (3.133104ms)
  ✔ ZWNJ in middle of goal is handled (3.755711ms)
  ✔ multiple ZWNJ in constraints are handled (3.887799ms)
  ✔ ZWJ at start of goal is handled (3.155175ms)
  ✔ ZWJ at end of goal is handled (2.527147ms)
  ✔ ZWJ in middle of goal is handled (3.076978ms)
  ✔ multiple ZWJ in constraints are handled (2.476814ms)
  ✔ BOM at start of goal is handled (2.27251ms)
  ✔ BOM at end of goal is handled (2.153427ms)
  ✔ BOM in middle of goal is handled (1.859727ms)
  ✔ multiple BOM in constraints are handled (2.298048ms)
  ✔ WJ at start of goal is handled (2.167684ms)
  ✔ WJ at end of goal is handled (1.99524ms)
  ✔ WJ in middle of goal is handled (2.169748ms)
  ✔ multiple WJ in constraints are handled (3.065597ms)
  ✔ NBSP at start of goal is handled (2.743473ms)
  ✔ NBSP at end of goal is handled (2.479158ms)
  ✔ NBSP in middle of goal is handled (1.673657ms)
  ✔ multiple NBSP in constraints are handled (2.059522ms)
  ✔ NNBSP at start of goal is handled (2.481873ms)
  ✔ NNBSP at end of goal is handled (1.85099ms)
  ✔ NNBSP in middle of goal is handled (2.511528ms)
  ✔ multiple NNBSP in constraints are handled (1.962228ms)
  ✔ RTL override characters are handled safely (0.428433ms)
  ✔ combining diacritical marks are handled (1.943304ms)
✔ Adversarial: Zero-Width Characters (83.226186ms)
▶ Adversarial: Extremely Long Strings
  ✔ goal with 10,000 characters (25.680113ms)
  ✔ goal with 50,000 characters (58.324092ms)
  ✔ 100 constraints each with 1,000 characters (205.777326ms)
  ✔ single constraint with 100,000 characters (160.770241ms)
  ✔ deeply nested context object (1.865227ms)
  ✔ context with 1000 keys (2.235ms)
✔ Adversarial: Extremely Long Strings (454.882882ms)
▶ Adversarial: Contradictory Constraints
  ✔ handles sync/async contradiction gracefully (2.221706ms)
  ✔ handles public/private contradiction gracefully (1.899872ms)
  ✔ handles sql/nosql contradiction gracefully (2.08058ms)
  ✔ handles rest/graphql contradiction gracefully (2.143258ms)
  ✔ handles monolith/microservice contradiction gracefully (3.017597ms)
  ✔ handles stateless/stateful contradiction gracefully (1.761442ms)
  ✔ handles online/offline contradiction gracefully (1.729442ms)
  ✔ handles single/multi-tenant contradiction gracefully (1.729533ms)
  ✔ handles open/closed-source contradiction gracefully (1.713192ms)
  ✔ handles real-time/batch contradiction gracefully (1.788834ms)
  ✔ multiple contradictions in same intent (2.272771ms)
  ✔ subtle contradiction: performance vs simplicity (2.231624ms)
✔ Adversarial: Contradictory Constraints (24.791918ms)
▶ Adversarial: List Ordering Attacks
  ✔ shuffled constraints produce identical bundle hash (7.481395ms)
  ✔ duplicates in different positions produce identical hash (3.320876ms)
  ✔ whitespace variations in constraints produce identical hash (4.709629ms)
  ✔ context key ordering is deterministic (0.307165ms)
✔ Adversarial: List Ordering Attacks (15.941676ms)
▶ Adversarial: Placeholder Density
  ✔ handles "TBD" in goal (1.784115ms)
  ✔ handles "TBD" in constraint (1.618674ms)
  ✔ handles "TODO" in goal (1.459986ms)
  ✔ handles "TODO" in constraint (1.613626ms)
  ✔ handles "FIXME" in goal (1.456621ms)
  ✔ handles "FIXME" in constraint (1.582707ms)
  ✔ handles "???" in goal (1.422868ms)
  ✔ handles "???" in constraint (2.140573ms)
  ✔ handles "..." in goal (1.431143ms)
  ✔ handles "..." in constraint (1.820242ms)
  ✔ handles "[TBD]" in goal (1.502988ms)
  ✔ handles "[TBD]" in constraint (1.63247ms)
  ✔ handles "(TBD)" in goal (1.431604ms)
  ✔ handles "(TBD)" in constraint (1.549033ms)
  ✔ handles "TO BE DETERMINED" in goal (1.468303ms)
  ✔ handles "TO BE DETERMINED" in constraint (1.638411ms)
  ✔ handles "TO DO" in goal (1.452102ms)
  ✔ handles "TO DO" in constraint (1.63267ms)
  ✔ handles "PLACEHOLDER" in goal (1.462352ms)
  ✔ handles "PLACEHOLDER" in constraint (1.710457ms)
  ✔ handles "XXX" in goal (1.463644ms)
  ✔ handles "XXX" in constraint (2.24608ms)
  ✔ handles "<<INSERT HERE>>" in goal (1.501214ms)
  ✔ handles "<<INSERT HERE>>" in constraint (1.628342ms)
  ✔ handles "<TBD>" in goal (1.430652ms)
  ✔ handles "<TBD>" in constraint (1.530339ms)
  ✔ handles "{TBD}" in goal (1.427897ms)
  ✔ handles "{TBD}" in constraint (1.538905ms)
  ✔ handles "NEEDS_WORK" in goal (1.432225ms)
  ✔ handles "NEEDS_WORK" in constraint (1.643812ms)
  ✔ goal consisting entirely of placeholders (0.132478ms)
  ✔ many placeholders increase entropy (3.93118ms)
  ✔ mixed real content and placeholders (2.478176ms)
  ✔ placeholder-like strings that are not placeholders (2.566391ms)
✔ Adversarial: Placeholder Density (57.183584ms)
▶ Adversarial Corpus Summary
  ✔ corpus contains expected number of fixtures (0.046958ms)
✔ Adversarial Corpus Summary (0.080691ms)
▶ Bundle Spec Invariants
  ▶ BS1: Schema Version Present
    ✔ simple intent has schema_version (17.481994ms)
    ✔ complex intent has schema_version (7.738418ms)
  ✔ BS1: Schema Version Present (25.768749ms)
  ▶ BS2: Hash Stability
    ✔ simple intent produces stable hash (10.237553ms)
    ✔ complex intent produces stable hash (10.906938ms)
    ✔ minimal intent produces stable hash (1.172569ms)
  ✔ BS2: Hash Stability (22.690689ms)
  ▶ BS3: Artifact Path Sorted
    ✔ simple intent outputs are sorted by path (4.035406ms)
    ✔ complex intent outputs are sorted by path (4.157955ms)
  ✔ BS3: Artifact Path Sorted (8.390851ms)
  ▶ BS4: Constraints Sorted
    ✔ simple intent constraints are sorted (3.250063ms)
    ✔ complex intent constraints are sorted (3.71244ms)
    ✔ constraint order in input does not affect sorting (0.606467ms)
  ✔ BS4: Constraints Sorted (7.722617ms)
  ▶ BS5: Questions Sorted
    ✔ simple intent questions are sorted (2.588122ms)
    ✔ complex intent questions are sorted (4.095839ms)
  ✔ BS5: Questions Sorted (6.831477ms)
  ▶ BS6: Terminal Nodes Sorted
    ✔ simple intent terminal nodes are sorted (2.44292ms)
    ✔ complex intent terminal nodes are sorted (4.263323ms)
  ✔ BS6: Terminal Nodes Sorted (6.795891ms)
  ▶ BS7: No Path Traversal
    ✔ simple intent has no path traversal (2.75774ms)
    ✔ complex intent has no path traversal (3.442764ms)
  ✔ BS7: No Path Traversal (6.301013ms)
  ▶ BS8: Canonical Idempotent
    ✔ simple intent is canonically idempotent (2.931255ms)
    ✔ complex intent is canonically idempotent (3.154354ms)
  ✔ BS8: Canonical Idempotent (6.186218ms)
  ▶ All Invariants Combined
    ✔ simple intent passes all invariants (2.94983ms)
    ✔ complex intent passes all invariants (3.39777ms)
    ✔ minimal intent passes all invariants (0.359935ms)
  ✔ All Invariants Combined (6.840223ms)
  ▶ Real Intents from Manifest
    ✔ loads manifest successfully (0.14939ms)
    ✔ all non-refusing intents pass bundle spec invariants (62.080714ms)
  ✔ Real Intents from Manifest (68.308109ms)
✔ Bundle Spec Invariants (166.518697ms)
▶ Canonical Serialization
  ✔ produces stable output for objects with different key insertion order (0.744024ms)
  ✔ produces stable output for nested objects (0.145122ms)
  ✔ handles arrays in index order (0.113362ms)
  ✔ round-trips through JSON parse (0.214091ms)
  ✔ rejects unsupported values (0.45916ms)
✔ Canonical Serialization (2.449833ms)
▶ Hash Stability
  ✔ produces identical hash for identical objects (0.501811ms)
  ✔ produces different hash for different objects (0.125505ms)
  ✔ produces consistent hash across multiple calls (0.827171ms)
✔ Hash Stability (1.617333ms)
▶ Transform Determinism
  ✔ produces identical bundle for simple intent (same process) (18.04512ms)
  ✔ produces identical bundle for complex intent (10.260315ms)
  ✔ produces identical bundle for minimal intent (0.585889ms)
  ✔ produces different bundle for different intents (8.850112ms)
  ✔ constraint order does not affect output (0.424776ms)
✔ Transform Determinism (38.476372ms)
▶ Validation Gates
  ✔ simple intent bundle passes all gates (3.913817ms)
  ✔ complex intent bundle passes all gates (3.324853ms)
  ✔ minimal intent bundle passes all gates (0.290594ms)
✔ Validation Gates (7.643039ms)
▶ Mutation Resistance
  ✔ deliberately randomized key insertion produces identical output (0.212829ms)
  ✔ repeated transforms produce identical bundle sequence (27.913691ms)
✔ Mutation Resistance (28.218081ms)
▶ Edge Cases
  ✔ handles empty constraints (0.231313ms)
  ✔ handles unicode in goal (5.514368ms)
  ✔ handles special characters in constraints (0.302517ms)
✔ Edge Cases (6.155019ms)
▶ Golden Hash Verification
  ✔ Golden Intent 001: User Authentication System (14.95676ms)
  ✔ Golden Intent 002: Hello World (0.512742ms)
  ✔ Golden Intent 003: REST API Server (6.829112ms)
✔ Golden Hash Verification (22.912225ms)
▶ Cross-Process Determinism
  ✔ can serialize and deserialize bundle for verification (4.185898ms)
✔ Cross-Process Determinism (4.3265ms)
▶ I1: Canonicalization Idempotence
  ✔ canonical(parse(canonical(x))) == canonical(x) for all seeds (2.364603ms)
  ✔ canonicalize is stable for objects with shuffled keys (0.413636ms)
  ✔ canonicalize round-trips through bytes (0.74113ms)
✔ I1: Canonicalization Idempotence (5.130969ms)
▶ I2: Normalization Idempotence
  ✔ normalizeIntent(normalizeIntent(x)) produces same result (2.235652ms)
  ✔ normalizeString is idempotent (0.379731ms)
  ✔ normalizeConstraint is idempotent (0.144501ms)
  ✔ normalizeConstraints is idempotent and sorted (1.124207ms)
✔ I2: Normalization Idempotence (4.087353ms)
▶ I3: Hash Stability
  ✔ canonicalHash produces same result across N runs (5.044176ms)
  ✔ bundle hash is stable across N transforms of same intent (88.637792ms)
  ✔ different intents produce different hashes (0.371917ms)
✔ I3: Hash Stability (94.254001ms)
▶ I4: Ordering Invariants
  ✔ outputs are always sorted by path (15.830267ms)
  ✔ unresolved_questions are sorted by (priority desc, id asc) (14.854399ms)
  ✔ terminal_nodes are sorted by id (14.952241ms)
  ✔ constraints within nodes are always sorted (15.344497ms)
✔ I4: Ordering Invariants (61.163174ms)
▶ I5: Validator Completeness
  ✔ empty goal always rejected (0.477926ms)
  ✔ missing required field (goal) always rejected (0.314549ms)
  ✔ contradictory constraints are detected and handled (39.023779ms)
  ✔ unicode normalization is consistent (NFC vs NFD) (0.112912ms)
  ✔ zero-width characters are handled consistently (33.268088ms)
  ✔ extremely long strings are handled without crash (10.383216ms)
  ✔ many constraints are handled deterministically (226.099305ms)
✔ I5: Validator Completeness (309.949651ms)
▶ Property Test Summary
  ✔ ran property tests across 100 seeds (0.13309ms)
✔ Property Test Summary (0.186609ms)
▶ Contradictory Constraints
  ✔ detects synchronous vs asynchronous contradiction (12.933277ms)
  ✔ detects public vs private contradiction (5.807909ms)
  ✔ detects required vs optional contradiction (0.195186ms)
  ✔ handles contradictions gracefully without crashing (1.233172ms)
✔ Contradictory Constraints (21.120866ms)
▶ Underspecified Intents
  ✔ handles minimal intent (just goal) (0.672301ms)
  ✔ detects high entropy for vague goals (0.261531ms)
  ✔ handles placeholder content (0.150132ms)
  ✔ handles TODO markers in constraints (0.119945ms)
✔ Underspecified Intents (1.435772ms)
▶ Adversarial Wording
  ✔ handles extremely long goal (27.74775ms)
  ✔ handles extremely long constraints (5.151758ms)
  ✔ handles many constraints (24.820542ms)
  ✔ handles special characters in goal (2.477745ms)
  ✔ handles unicode edge cases (3.795004ms)
  ✔ handles newlines and whitespace (0.285365ms)
  ✔ handles empty strings in constraints array (0.102131ms)
  ✔ handles duplicate constraints (0.05344ms)
✔ Adversarial Wording (64.767271ms)
▶ Malformed Inputs
  ✔ rejects empty goal (0.312586ms)
  ✔ rejects whitespace-only goal (0.071804ms)
  ✔ handles constraints as undefined (0.040536ms)
  ✔ handles context as undefined (0.024676ms)
✔ Malformed Inputs (0.515837ms)
▶ Boundary Conditions
  ✔ handles single character goal (0.41067ms)
  ✔ produces deterministic output for near-identical inputs (4.127939ms)
  ✔ handles maximum decomposition depth gracefully (2.853309ms)
  ✔ handles zero entropy case (0.238668ms)
✔ Boundary Conditions (7.716968ms)
▶ Security Edge Cases
  ✔ handles potential injection in goal (2.105928ms)
  ✔ handles potential path traversal in constraints (0.18129ms)
  ✔ handles extremely nested context (0.20831ms)
✔ Security Edge Cases (2.575268ms)
▶ Bundle CLI Functions
  ▶ bundle-verify behavior
    ✔ returns ok:true for valid bundle (6.701283ms)
    ✔ returns ok:false with violations for invalid bundle (1.127784ms)
    ✔ output is deterministic (1.007498ms)
  ✔ bundle-verify behavior (9.497715ms)
  ▶ bundle-summarize behavior
    ✔ produces canonical JSON summary for valid bundle (1.371041ms)
    ✔ summary includes all required fields (0.754875ms)
    ✔ output keys are sorted (canonical) (1.260864ms)
    ✔ output is byte-identical across runs (1.099822ms)
  ✔ bundle-summarize behavior (4.88032ms)
  ▶ Error handling patterns
    ✔ verify handles malformed input gracefully (0.342052ms)
    ✔ verify handles array input (0.119845ms)
    ✔ verify handles primitive input (0.097493ms)
  ✔ Error handling patterns (0.786905ms)
✔ Bundle CLI Functions (15.712156ms)
▶ Verifier Report Ingestion
  ▶ validateFolderName
    ✔ accepts valid folder names (6.061102ms)
    ✔ accepts folder names with underscores in verifier_id (1.001828ms)
    ✔ accepts folder names with hyphens in verifier_id (0.904165ms)
    ✔ rejects invalid format (0.891371ms)
    ✔ rejects missing date (0.98136ms)
    ✔ rejects invalid date (0.558698ms)
  ✔ validateFolderName (11.348675ms)
  ▶ validateRequiredFiles
    ✔ passes when VERIFIER_REPORT.md exists (1.962269ms)
    ✔ fails when VERIFIER_REPORT.md is missing (1.123406ms)
  ✔ validateRequiredFiles (3.283977ms)
  ▶ validateJsonSchema
    ✔ accepts valid JSON with all required fields (1.570824ms)
    ✔ rejects JSON missing required fields (1.298535ms)
    ✔ rejects invalid schema_version (1.875657ms)
    ✔ rejects malformed JSON (0.874881ms)
  ✔ validateJsonSchema (5.864174ms)
  ▶ parseMarkdownReport
    ✔ parses valid markdown report correctly (0.954139ms)
    ✔ fails with stable error when verifier_kind is missing (1.090565ms)
    ✔ detects version mismatch (0.695934ms)
    ✔ reports missing verifier_kind with stable error message (0.322034ms)
    ✔ reports other missing fields after verifier_kind present (0.355697ms)
  ✔ parseMarkdownReport (3.621038ms)
  ▶ Index Entry Management
    ✔ formats table row correctly (0.635862ms)
    ✔ parses existing entries from index content (0.705162ms)
    ✔ detects duplicates correctly (0.439293ms)
  ✔ Index Entry Management (1.928115ms)
  ▶ Valid submission with JSON passes and updates index deterministically
    ✔ parses and validates correctly (1.669079ms)
  ✔ Valid submission with JSON passes and updates index deterministically (1.76551ms)
  ▶ Valid submission without JSON passes
    ✔ parses markdown-only submission correctly (0.504886ms)
  ✔ Valid submission without JSON passes (0.603031ms)
  ▶ Invalid JSON fails with stable error message
    ✔ produces consistent error for invalid JSON (1.198898ms)
  ✔ Invalid JSON fails with stable error message (1.28041ms)
✔ Verifier Report Ingestion (30.301738ms)
▶ Patch CLI
  ▶ Valid Patch
    ✔ returns ok:true for valid patch (26.663547ms)
  ✔ Valid Patch (27.369601ms)
  ▶ Invalid Patches
    ✔ returns violations for absolute path (22.462722ms)
    ✔ returns violations for traversal path (22.270441ms)
    ✔ returns violations for duplicate paths (21.998852ms)
    ✔ returns violations for binary content (18.675732ms)
  ✔ Invalid Patches (85.842081ms)
  ▶ Determinism
    ✔ produces byte-identical output across runs (valid) (37.715517ms)
    ✔ produces byte-identical output across runs (invalid) (36.332634ms)
    ✔ violations are sorted deterministically (19.616386ms)
  ✔ Determinism (93.937036ms)
  ▶ Error Handling
    ✔ returns exit 1 for missing file (16.536872ms)
    ✔ returns exit 2 for invalid JSON (35.71183ms)
  ✔ Error Handling (52.438498ms)
  ▶ Options
    ✔ --max-bytes enforces limit (17.29319ms)
    ✔ --help shows usage (16.564765ms)
  ✔ Options (34.068659ms)
✔ Patch CLI (295.757665ms)
▶ Reference Release Tagging
  ▶ validateRelease
    ✔ accepts valid release format (3.821224ms)
    ✔ rejects invalid release format (0.859862ms)
  ✔ validateRelease (5.176154ms)
  ▶ validateDate
    ✔ accepts valid date format (0.937959ms)
    ✔ rejects invalid date format (0.643256ms)
    ✔ requires date when not dry-run (3.975283ms)
    ✔ allows missing date in dry-run mode (0.521998ms)
  ✔ validateDate (6.425757ms)
  ▶ parseMarkdownForVerification
    ✔ parses internal verifier_kind (0.845906ms)
    ✔ parses independent verifier_kind (0.993021ms)
    ✔ returns null for missing verifier_kind (1.403852ms)
  ✔ parseMarkdownForVerification (3.617441ms)
  ▶ loadInternalReports
    ✔ loads only internal reports from fixture (1.627812ms)
    ✔ returns empty array when only independent reports exist (1.047243ms)
    ✔ returns empty array when no verified folder (0.469611ms)
  ✔ loadInternalReports (3.330824ms)
  ▶ checkIndexAlreadyRecorded
    ✔ returns false when Reference Tag not recorded (1.34957ms)
    ✔ returns true when Reference Tag already recorded (0.51216ms)
  ✔ checkIndexAlreadyRecorded (1.984801ms)
  ▶ updateIndexWithReferenceTag
    ✔ adds Reference Tag row to INDEX.md (0.9436ms)
    ✔ produces deterministic output (0.683732ms)
  ✔ updateIndexWithReferenceTag (1.768596ms)
  ▶ createStubGitHelper
    ✔ returns configured commit for rev-parse (0.659847ms)
    ✔ reports tag existence correctly (1.407699ms)
  ✔ createStubGitHelper (2.207708ms)
  ▶ Threshold not met
    ✔ returns exit code 2 when no internal reports exist (0.609443ms)
    ✔ independent-only reports do NOT count toward reference threshold (0.931827ms)
  ✔ Threshold not met (1.655734ms)
  ▶ Threshold met dry-run
    ✔ outputs JSON with expected reference tag name (0.671299ms)
  ✔ Threshold met dry-run (0.759714ms)
  ▶ Already recorded
    ✔ refuses with stable message when INDEX.md already has Reference Tag (0.46448ms)
  ✔ Already recorded (0.556674ms)
  ▶ Determinism
    ✔ produces stable error messages (0.627086ms)
    ✔ produces stable report loading order (1.433808ms)
    ✔ dry-run JSON output is byte-identical across runs (1.144767ms)
  ✔ Determinism (3.393091ms)
✔ Reference Release Tagging (31.560077ms)
▶ Verified Release Tagging
  ▶ validateRelease
    ✔ accepts valid release format (3.58452ms)
    ✔ rejects invalid release format (0.732614ms)
  ✔ validateRelease (4.838842ms)
  ▶ validateDate
    ✔ accepts valid date format (1.319023ms)
    ✔ rejects invalid date format (0.625814ms)
    ✔ requires date when not dry-run (0.649728ms)
    ✔ allows missing date in dry-run mode (0.429816ms)
  ✔ validateDate (3.352896ms)
  ▶ validateThreshold
    ✔ accepts valid threshold (0.931356ms)
    ✔ rejects invalid threshold (1.387171ms)
  ✔ validateThreshold (2.584656ms)
  ▶ parseMarkdownForVerification
    ✔ parses valid verified report with verifier_kind (1.060859ms)
    ✔ parses internal verifier_kind (0.611476ms)
    ✔ returns null for missing verifier_kind (0.702426ms)
    ✔ detects failed result (3.834429ms)
    ✔ handles missing fields (0.50689ms)
    ✔ handles placeholder fields (0.614923ms)
  ✔ parseMarkdownForVerification (7.713952ms)
  ▶ loadVerifiedReports
    ✔ loads valid reports from fixture with verifier_kind (1.68053ms)
    ✔ returns empty array when no verified folder (0.460504ms)
    ✔ excludes reports with missing required fields (0.599604ms)
    ✔ loads internal reports when present (1.416907ms)
  ✔ loadVerifiedReports (4.396341ms)
  ▶ checkIndexAlreadyRecorded
    ✔ returns false when not recorded (0.587982ms)
    ✔ returns true when already recorded (0.675627ms)
  ✔ checkIndexAlreadyRecorded (1.397379ms)
  ▶ updateIndexWithVerifiedTag
    ✔ adds Verified Tag row to INDEX.md (0.787015ms)
    ✔ produces deterministic output (0.539171ms)
  ✔ updateIndexWithVerifiedTag (1.450269ms)
  ▶ createStubGitHelper
    ✔ returns configured commit for rev-parse (0.439705ms)
    ✔ reports tag existence correctly (0.279965ms)
  ✔ createStubGitHelper (0.833814ms)
  ▶ Threshold not met
    ✔ returns exit code 2 with exact error string for no reports (0.647033ms)
    ✔ internal-only reports do NOT count toward verified threshold (0.667532ms)
  ✔ Threshold not met (1.438747ms)
  ▶ Threshold met dry-run
    ✔ outputs JSON with expected tag name and verifier_kind counts (1.529988ms)
  ✔ Threshold met dry-run (1.625527ms)
  ▶ Invalid report with missing fields
    ✔ tool refuses to count reports with missing OS/node/npm (0.530063ms)
  ✔ Invalid report with missing fields (0.577733ms)
  ▶ Already verified recorded
    ✔ refuses with stable message when INDEX.md already has Verified Tag (0.566993ms)
  ✔ Already verified recorded (0.702447ms)
  ▶ Determinism
    ✔ produces stable error messages (0.738154ms)
    ✔ produces stable report loading order (0.967053ms)
    ✔ dry-run JSON output is byte-identical across runs (0.78928ms)
  ✔ Determinism (2.651862ms)
✔ Verified Release Tagging (34.376367ms)
ℹ tests 552
ℹ suites 160
ℹ pass 552
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 723.783588
