
> context-engine-kernel@0.1.0 test
> node --test dist/tests/*.test.js dist/harness/tests/*.test.js dist/tools/tests/*.test.js dist/consumer/tests/*.test.js

▶ Bundle Summary
  ▶ Outcome Detection
    ✔ detects BUNDLE outcome for complete status (3.60941ms)
    ✔ detects CLARIFY outcome for incomplete status (0.760356ms)
    ✔ detects REFUSE outcome for error status (0.457178ms)
  ✔ Outcome Detection (5.303657ms)
  ▶ Field Extraction
    ✔ extracts schema_version correctly (0.750738ms)
    ✔ computes bundle_hash (0.544461ms)
    ✔ counts artifacts correctly (0.430357ms)
    ✔ counts unresolved questions correctly (0.540093ms)
    ✔ counts terminal nodes correctly (0.494156ms)
  ✔ Field Extraction (3.079866ms)
  ▶ Sorting
    ✔ artifact_paths are sorted lexicographically (2.361209ms)
    ✔ question_ids are sorted by priority desc, id asc (0.640712ms)
    ✔ terminal_node_ids are sorted lexicographically (0.487003ms)
  ✔ Sorting (3.697124ms)
  ▶ Determinism
    ✔ produces identical summary for same bundle (0.755106ms)
    ✔ summary is byte-identical across multiple runs (1.126853ms)
    ✔ canonical JSON has sorted keys (0.446377ms)
  ✔ Determinism (2.488037ms)
  ▶ Edge Cases
    ✔ handles bundle with no outputs (0.859332ms)
    ✔ handles bundle with no unresolved questions (1.395328ms)
    ✔ handles bundle with no terminal nodes (0.564008ms)
  ✔ Edge Cases (2.997662ms)
✔ Bundle Summary (17.943423ms)
▶ Bundle Verification
  ▶ Valid Bundles
    ✔ accepts valid BUNDLE outcome (4.382669ms)
    ✔ accepts valid CLARIFY outcome (0.889298ms)
    ✔ accepts valid REFUSE outcome (0.549721ms)
  ✔ Valid Bundles (6.383903ms)
  ▶ Invalid Bundles
    ✔ rejects bundle with unsorted output paths (BS3) (1.30643ms)
    ✔ rejects bundle with path traversal (BS7) (0.946215ms)
    ✔ rejects non-object bundle (0.162244ms)
    ✔ rejects null bundle (0.09575ms)
    ✔ rejects bundle with missing schema_version (BS1) (0.104155ms)
    ✔ rejects bundle with empty schema_version (BS1) (0.082845ms)
  ✔ Invalid Bundles (2.96399ms)
  ▶ Violation Ordering
    ✔ violations are sorted by rule_id then path (0.648747ms)
  ✔ Violation Ordering (0.710983ms)
  ▶ Determinism
    ✔ produces identical result for same input (2.827113ms)
    ✔ violations are byte-identical across runs (0.937248ms)
  ✔ Determinism (3.922978ms)
✔ Bundle Verification (14.352268ms)
▶ Evidence Spec Invariants
  ▶ EV1: Proposal Hash Integrity
    ✔ valid evidence has valid proposal_hash (0.447169ms)
    ✔ rejects missing proposal_hash (0.225463ms)
    ✔ rejects invalid hash format (0.71982ms)
    ✔ accepts sha256-prefixed hash (0.108103ms)
    ✔ accepts bare hex hash (0.076323ms)
  ✔ EV1: Proposal Hash Integrity (1.986656ms)
  ▶ EV2: Action Results Consistency
    ✔ valid action results pass (0.181861ms)
    ✔ rejects missing action_id (3.425485ms)
    ✔ rejects invalid status (0.222106ms)
    ✔ rejects negative duration_ms (0.188353ms)
    ✔ accepts all valid status types (0.201468ms)
  ✔ EV2: Action Results Consistency (4.528874ms)
  ▶ EV3: Test Results Validity
    ✔ valid test results pass (0.169268ms)
    ✔ rejects missing test_id (0.158537ms)
    ✔ rejects non-boolean passed (0.105317ms)
    ✔ rejects non-string actual (0.066866ms)
  ✔ EV3: Test Results Validity (0.634661ms)
  ▶ EV4: Status Consistency
    ✔ complete status with successful actions passes (0.136797ms)
    ✔ failed status with failures passes (0.066014ms)
    ✔ partial status passes (0.091772ms)
    ✔ rejects complete status with failures (0.068198ms)
    ✔ rejects invalid status value (0.059021ms)
  ✔ EV4: Status Consistency (0.55969ms)
  ▶ EV5: Evidence Hash Determinism
    ✔ hash is deterministic for same evidence (0.673443ms)
    ✔ hash is same regardless of ephemeral fields (0.129713ms)
    ✔ hash differs for different core fields (0.155522ms)
    ✔ hash is deterministic for complex evidence (6.344931ms)
  ✔ EV5: Evidence Hash Determinism (7.483125ms)
  ▶ All Invariants Combined
    ✔ valid evidence passes all invariants (0.242394ms)
    ✔ failed evidence passes all invariants (0.15452ms)
    ✔ partial evidence passes all invariants (0.141395ms)
  ✔ All Invariants Combined (0.67155ms)
  ▶ EvidenceCore Computation
    ✔ computeEvidenceCore excludes ephemeral fields (0.117991ms)
    ✔ computeEvidenceCore sorts action_results by action_id (0.109715ms)
    ✔ computeEvidenceCore sorts test_results by test_id (0.09064ms)
  ✔ EvidenceCore Computation (0.407775ms)
✔ Evidence Spec Invariants (16.737281ms)
▶ Harness: Plan-Only Mode
  ✔ processes simple intent without execution (6.56348ms)
  ✔ handles clarify result for vague intent (12.030022ms)
  ✔ produces deterministic results for same intent (2.273965ms)
✔ Harness: Plan-Only Mode (21.704257ms)
▶ Harness: Execute-Sandbox Mode
  ✔ executes proposal in sandbox and captures evidence (5.428121ms)
  ✔ sandbox never writes outside sandbox dir (4.621438ms)
  ✔ respects policy timeout (0.210154ms)
✔ Harness: Execute-Sandbox Mode (10.586415ms)
▶ Harness: Policy Profiles
  ✔ strict policy has most restrictive settings (0.128841ms)
  ✔ default policy is balanced (0.085361ms)
  ✔ dev policy is relaxed (0.514135ms)
  ✔ policy is included in result (1.635668ms)
✔ Harness: Policy Profiles (2.577234ms)
▶ Harness: Kernel Authority
  ✔ kernel generates bundle (harness does not) (1.456611ms)
  ✔ kernel validates evidence (harness does not decide) (2.419959ms)
✔ Harness: Kernel Authority (4.042432ms)
▶ Harness: Result Structure
  ✔ result has all required fields (1.256126ms)
  ✔ timestamps are valid ISO 8601 UTC (1.67996ms)
✔ Harness: Result Structure (3.101347ms)
▶ Ledger Spec Invariants
  ▶ LD1: One Entry Per Line
    ✔ valid single entry parses correctly (0.773611ms)
    ✔ valid multiple entries parse correctly (0.180258ms)
    ✔ rejects invalid JSON (0.360717ms)
    ✔ rejects missing required fields (0.152075ms)
    ✔ rejects invalid result_kind (0.176802ms)
    ✔ rejects invalid mode (0.123782ms)
    ✔ rejects invalid policy (0.126397ms)
    ✔ accepts all valid result_kind values (0.211176ms)
    ✔ accepts all valid mode values (0.406602ms)
    ✔ accepts all valid policy values (0.185979ms)
  ✔ LD1: One Entry Per Line (4.238831ms)
  ▶ LD2: Monotonic Timestamps
    ✔ ascending timestamps pass (0.792497ms)
    ✔ equal timestamps pass (0.071644ms)
    ✔ descending timestamps fail (0.098796ms)
    ✔ single entry passes (0.047429ms)
    ✔ empty array passes (0.052148ms)
  ✔ LD2: Monotonic Timestamps (1.197486ms)
  ▶ LD3: Unique Run IDs
    ✔ unique run_ids pass (0.121248ms)
    ✔ duplicate run_ids fail (0.120366ms)
    ✔ single entry passes (0.049143ms)
    ✔ empty array passes (0.035977ms)
  ✔ LD3: Unique Run IDs (0.41015ms)
  ▶ LD4: Valid Content Hashes
    ✔ valid hashes pass (0.160401ms)
    ✔ null bundle_sha256 passes (0.077907ms)
    ✔ invalid intent_sha256 fails (0.115106ms)
    ✔ invalid bundle_sha256 fails (0.097653ms)
    ✔ hash without sha256 prefix fails (0.092463ms)
    ✔ hash with wrong length fails (0.067937ms)
  ✔ LD4: Valid Content Hashes (0.736682ms)
  ▶ All Invariants Combined
    ✔ valid ledger passes all checks (0.160161ms)
    ✔ empty ledger passes (0.051307ms)
    ✔ single valid entry passes (0.071825ms)
  ✔ All Invariants Combined (0.465443ms)
  ▶ serializeLedgerEntry
    ✔ produces canonical JSON (0.102953ms)
    ✔ produces valid JSON (0.061526ms)
    ✔ serialized entry passes invariant checks (0.059331ms)
  ✔ serializeLedgerEntry (0.301746ms)
  ▶ createLedgerEntry
    ✔ creates valid entry from HarnessRunResult (0.303159ms)
    ✔ created entry passes invariant checks (0.118603ms)
    ✔ handles null bundle correctly (0.0692ms)
  ✔ createLedgerEntry (0.578064ms)
  ▶ Content Hash Validation
    ✔ isValidContentHash accepts valid hashes (0.112351ms)
    ✔ isValidContentHash rejects invalid hashes (0.060844ms)
  ✔ Content Hash Validation (0.229781ms)
✔ Ledger Spec Invariants (8.6855ms)
▶ Policy Spec Invariants
  ▶ PL1: Profile Enum
    ✔ strict profile has valid name (0.468479ms)
    ✔ default profile has valid name (0.105918ms)
    ✔ dev profile has valid name (0.073768ms)
    ✔ listPolicies returns all three profiles (0.525095ms)
  ✔ PL1: Profile Enum (1.66329ms)
  ▶ PL2: Resolved Complete
    ✔ strict profile is fully populated (0.14927ms)
    ✔ default profile is fully populated (0.272762ms)
    ✔ dev profile is fully populated (0.151564ms)
    ✔ all profiles have no undefined values (0.246382ms)
  ✔ PL2: Resolved Complete (1.036223ms)
  ▶ PL3: Limits Within Bounds
    ✔ strict profile limits are within bounds (0.446377ms)
    ✔ default profile limits are within bounds (0.233198ms)
    ✔ dev profile limits are within bounds (0.121197ms)
    ✔ strict has most restrictive timeout (0.072636ms)
    ✔ strict has most restrictive file limits (0.103003ms)
    ✔ strict has most restrictive byte limits (0.054392ms)
  ✔ PL3: Limits Within Bounds (1.257368ms)
  ▶ PL4: Model Mode Strict/Default
    ✔ strict allows only none mode (0.124955ms)
    ✔ default allows only none mode (0.080561ms)
    ✔ strict rejects record with PL4 error (0.437351ms)
    ✔ strict rejects replay with PL4 error (0.097713ms)
    ✔ default rejects record with PL4 error (0.10684ms)
    ✔ default rejects replay with PL4 error (0.125645ms)
    ✔ error message is stable and deterministic (0.083236ms)
  ✔ PL4: Model Mode Strict/Default (1.216863ms)
  ▶ PL5: Model Mode Dev
    ✔ dev allows all modes (0.201437ms)
    ✔ dev none mode requires no recording path (0.054051ms)
    ✔ dev record mode requires recording path (0.118352ms)
    ✔ dev replay mode requires recording path (0.108133ms)
    ✔ dev record mode with path passes (0.051536ms)
    ✔ dev replay mode with path passes (0.043772ms)
    ✔ PL5 error message is stable (0.230833ms)
  ✔ PL5: Model Mode Dev (0.958057ms)
  ▶ PL6: Sandbox Constraints
    ✔ strict allows only specified commands (0.16024ms)
    ✔ default allows specified commands (0.061997ms)
    ✔ dev allows all commands (empty list) (0.058339ms)
    ✔ strict allows only specified write roots (0.104136ms)
    ✔ default allows more write roots (0.142657ms)
    ✔ dev allows all write paths (empty list) (0.125275ms)
  ✔ PL6: Sandbox Constraints (0.786906ms)
  ▶ PL7: Evidence Policy Binding
    ✔ harness result includes full policy object (17.094742ms)
    ✔ policy in result matches resolved policy exactly (2.885763ms)
    ✔ policy binding is deterministic across runs (1.31148ms)
  ✔ PL7: Evidence Policy Binding (21.526924ms)
  ▶ Deterministic Resolution
    ✔ loadPolicy returns identical object for same profile (0.128331ms)
    ✔ loadPolicy is byte-identical across multiple calls (0.156634ms)
    ✔ profile values match documented spec (0.168396ms)
  ✔ Deterministic Resolution (0.544531ms)
  ▶ All Invariants Combined
    ✔ strict profile passes all invariants (0.073488ms)
    ✔ default profile passes all invariants (0.039494ms)
    ✔ dev profile passes all invariants (0.034184ms)
  ✔ All Invariants Combined (0.231605ms)
✔ Policy Spec Invariants (29.858421ms)
▶ Run Spec Invariants
  ▶ RS1: Schema Version Present
    ✔ valid schema version passes (0.453962ms)
    ✔ missing schema version fails (0.359204ms)
    ✔ empty schema version fails (0.130365ms)
  ✔ RS1: Schema Version Present (1.347598ms)
  ▶ RS2: Outcome Coverage
    ✔ BUNDLE outcome passes (0.184316ms)
    ✔ CLARIFY outcome passes (0.107301ms)
    ✔ REFUSE outcome passes (0.118703ms)
    ✔ invalid outcome fails (0.296186ms)
  ✔ RS2: Outcome Coverage (0.922921ms)
  ▶ RS3: Outcome-Field Consistency
    ✔ BUNDLE with non-null bundle passes (0.335238ms)
    ✔ BUNDLE with null bundle fails (0.206046ms)
    ✔ BUNDLE with clarify_questions fails (0.198041ms)
    ✔ CLARIFY with clarify_questions passes (0.089138ms)
    ✔ CLARIFY without clarify_questions fails (0.198072ms)
    ✔ REFUSE with refuse_reason passes (0.077756ms)
    ✔ REFUSE without refuse_reason fails (0.152125ms)
  ✔ RS3: Outcome-Field Consistency (1.496917ms)
  ▶ RS4: Reference Integrity
    ✔ valid hashes pass (0.167013ms)
    ✔ invalid intent hash fails (0.118432ms)
    ✔ invalid bundle hash fails (0.107211ms)
    ✔ empty bundle_id fails (0.105959ms)
  ✔ RS4: Reference Integrity (0.606668ms)
  ▶ RS5: Policy Binding
    ✔ matching policy passes (0.267061ms)
    ✔ modified policy fails (0.121168ms)
  ✔ RS5: Policy Binding (0.464591ms)
  ▶ RS6: No Leak
    ✔ relative path passes (0.110797ms)
    ✔ absolute path fails (0.130325ms)
    ✔ Windows absolute path fails (0.103754ms)
  ✔ RS6: No Leak (0.428244ms)
  ▶ RS7: Canonical Output
    ✔ valid result is canonically stable (0.17032ms)
    ✔ result with arrays is canonically stable (0.168987ms)
  ✔ RS7: Canonical Output (0.404549ms)
  ▶ RS8: Decision Consistency
    ✔ validated_by_kernel true passes (0.12811ms)
    ✔ validated_by_kernel false fails (0.123231ms)
    ✔ CLARIFY with accepted true fails (0.099156ms)
    ✔ REFUSE with accepted true fails (0.114144ms)
  ✔ RS8: Decision Consistency (0.571973ms)
  ▶ All Invariants Combined
    ✔ valid BUNDLE result passes all checks (0.379642ms)
    ✔ valid CLARIFY result passes all checks (0.418415ms)
    ✔ valid REFUSE result passes all checks (0.155852ms)
  ✔ All Invariants Combined (1.063985ms)
  ▶ Integration: Real Harness Run
    ✔ runHarness produces spec-compliant result (21.904613ms)
    ✔ runHarness uses sanitized intent path (1.917647ms)
    ✔ runHarness produces canonical output (1.299116ms)
  ✔ Integration: Real Harness Run (25.380412ms)
✔ Run Spec Invariants (33.269649ms)
▶ Security: Symlink Escape
  ✔ refuses to follow symlinks in output directory (8.3603ms)
  ✔ refuses to follow directory symlinks (2.490792ms)
✔ Security: Symlink Escape (12.08724ms)
▶ Security: Path Traversal
  ✔ validates isPathSafe correctly (2.764044ms)
  ✔ rejects absolute paths in output (1.903029ms)
✔ Security: Path Traversal (4.924496ms)
▶ Security: File Spam
  ✔ respects max_output_files limit (51.227119ms)
  ✔ respects max_total_output_bytes limit (27.290575ms)
✔ Security: File Spam (78.747744ms)
▶ Security: Deep Recursion
  ✔ limits directory traversal depth (2.982875ms)
  ✔ allows directories within depth limit (1.132133ms)
✔ Security: Deep Recursion (4.275368ms)
▶ Security: Combined Attacks
  ✔ handles multiple security issues simultaneously (6.052331ms)
✔ Security: Combined Attacks (6.144684ms)
▶ MockModelAdapter
  ✔ should return configured response for exact prompt (1.943896ms)
  ✔ should throw AdapterError for unmatched prompt in strict mode (0.592952ms)
  ✔ should echo prompt in echo mode (0.153358ms)
  ✔ should return fixed content in fixed mode (0.129493ms)
  ✔ should match substring patterns (0.130986ms)
  ✔ should record interactions when enabled (0.398798ms)
  ✔ should export recording session (0.193102ms)
  ✔ should report ready state correctly (0.145193ms)
  ✔ should have correct adapter_id and model_id (0.166503ms)
  ✔ should estimate tokens from content length (0.19741ms)
✔ MockModelAdapter (4.979329ms)
▶ RecordingModelAdapter
  ✔ should record interactions from delegate (0.276298ms)
  ✔ should delegate transform calls correctly (0.112862ms)
  ✔ should compute stats correctly (0.193413ms)
  ✔ should respect max_interactions limit (0.167444ms)
  ✔ should redact prompts when include_prompts is false (0.076614ms)
  ✔ should delegate isReady and shutdown (0.109245ms)
✔ RecordingModelAdapter (1.115772ms)
▶ ReplayModelAdapter
  ✔ should replay recorded response by prompt hash (0.285626ms)
  ✔ should throw for unrecorded prompt in strict mode (0.134692ms)
  ✔ should return empty content for unrecorded prompt in non-strict mode (0.090801ms)
  ✔ should enforce sequence order in sequential mode (0.107943ms)
  ✔ should fail in sequential mode if prompts are out of order (0.128782ms)
  ✔ should report recording count (0.073568ms)
  ✔ should check hasRecording correctly (0.066715ms)
  ✔ should always be ready (0.070222ms)
✔ ReplayModelAdapter (1.102648ms)
▶ Record and Replay Integration
  ✔ should produce identical results when replaying recorded session (0.529864ms)
  ✔ should create adapter from recording session (0.216095ms)
✔ Record and Replay Integration (0.810289ms)
▶ Adapter Determinism
  ✔ should produce identical results across multiple runs (0.14929ms)
  ✔ should produce same hash for same prompt regardless of context metadata (0.061556ms)
✔ Adapter Determinism (0.273353ms)
▶ Adversarial: Unicode Normalization
  ✔ A-umlaut: NFC and NFD produce identical normalized output (0.74657ms)
  ✔ O-umlaut: NFC and NFD produce identical normalized output (0.105588ms)
  ✔ U-umlaut: NFC and NFD produce identical normalized output (0.070141ms)
  ✔ e-acute: NFC and NFD produce identical normalized output (0.06933ms)
  ✔ n-tilde: NFC and NFD produce identical normalized output (0.093425ms)
  ✔ c-cedilla: NFC and NFD produce identical normalized output (0.041608ms)
  ✔ a-grave: NFC and NFD produce identical normalized output (0.041027ms)
  ✔ mixed NFC/NFD in constraints produce identical hashes (0.509446ms)
  ✔ Korean Hangul syllables (precomposed vs jamo) (16.060632ms)
✔ Adversarial: Unicode Normalization (18.66662ms)
▶ Adversarial: Zero-Width Characters
  ✔ ZWSP at start of goal is handled (4.298051ms)
  ✔ ZWSP at end of goal is handled (3.976829ms)
  ✔ ZWSP in middle of goal is handled (4.440328ms)
  ✔ multiple ZWSP in constraints are handled (3.4018ms)
  ✔ ZWNJ at start of goal is handled (3.956821ms)
  ✔ ZWNJ at end of goal is handled (3.730907ms)
  ✔ ZWNJ in middle of goal is handled (3.007852ms)
  ✔ multiple ZWNJ in constraints are handled (3.516495ms)
  ✔ ZWJ at start of goal is handled (2.574328ms)
  ✔ ZWJ at end of goal is handled (2.631295ms)
  ✔ ZWJ in middle of goal is handled (2.250501ms)
  ✔ multiple ZWJ in constraints are handled (2.765307ms)
  ✔ BOM at start of goal is handled (2.324009ms)
  ✔ BOM at end of goal is handled (2.560842ms)
  ✔ BOM in middle of goal is handled (1.918768ms)
  ✔ multiple BOM in constraints are handled (2.109567ms)
  ✔ WJ at start of goal is handled (1.935741ms)
  ✔ WJ at end of goal is handled (2.282781ms)
  ✔ WJ in middle of goal is handled (2.317687ms)
  ✔ multiple WJ in constraints are handled (3.311421ms)
  ✔ NBSP at start of goal is handled (2.461627ms)
  ✔ NBSP at end of goal is handled (2.037752ms)
  ✔ NBSP in middle of goal is handled (1.597175ms)
  ✔ multiple NBSP in constraints are handled (1.904672ms)
  ✔ NNBSP at start of goal is handled (1.938846ms)
  ✔ NNBSP at end of goal is handled (1.597246ms)
  ✔ NNBSP in middle of goal is handled (2.281288ms)
  ✔ multiple NNBSP in constraints are handled (1.97828ms)
  ✔ RTL override characters are handled safely (0.333906ms)
  ✔ combining diacritical marks are handled (2.093176ms)
✔ Adversarial: Zero-Width Characters (78.609917ms)
▶ Adversarial: Extremely Long Strings
  ✔ goal with 10,000 characters (25.299991ms)
  ✔ goal with 50,000 characters (57.252189ms)
  ✔ 100 constraints each with 1,000 characters (202.520636ms)
  ✔ single constraint with 100,000 characters (158.043276ms)
  ✔ deeply nested context object (1.834711ms)
  ✔ context with 1000 keys (2.371899ms)
✔ Adversarial: Extremely Long Strings (447.547614ms)
▶ Adversarial: Contradictory Constraints
  ✔ handles sync/async contradiction gracefully (3.726278ms)
  ✔ handles public/private contradiction gracefully (1.880978ms)
  ✔ handles sql/nosql contradiction gracefully (2.080031ms)
  ✔ handles rest/graphql contradiction gracefully (1.99915ms)
  ✔ handles monolith/microservice contradiction gracefully (1.908881ms)
  ✔ handles stateless/stateful contradiction gracefully (1.807039ms)
  ✔ handles online/offline contradiction gracefully (1.854728ms)
  ✔ handles single/multi-tenant contradiction gracefully (1.796099ms)
  ✔ handles open/closed-source contradiction gracefully (1.833349ms)
  ✔ handles real-time/batch contradiction gracefully (1.899242ms)
  ✔ multiple contradictions in same intent (3.340386ms)
  ✔ subtle contradiction: performance vs simplicity (1.907928ms)
✔ Adversarial: Contradictory Constraints (26.214457ms)
▶ Adversarial: List Ordering Attacks
  ✔ shuffled constraints produce identical bundle hash (6.306478ms)
  ✔ duplicates in different positions produce identical hash (3.390479ms)
  ✔ whitespace variations in constraints produce identical hash (4.797959ms)
  ✔ context key ordering is deterministic (0.284935ms)
✔ Adversarial: List Ordering Attacks (14.871222ms)
▶ Adversarial: Placeholder Density
  ✔ handles "TBD" in goal (1.761885ms)
  ✔ handles "TBD" in constraint (1.634085ms)
  ✔ handles "TODO" in goal (2.177985ms)
  ✔ handles "TODO" in constraint (1.619217ms)
  ✔ handles "FIXME" in goal (1.456401ms)
  ✔ handles "FIXME" in constraint (1.569805ms)
  ✔ handles "???" in goal (1.443929ms)
  ✔ handles "???" in constraint (1.533927ms)
  ✔ handles "..." in goal (1.41253ms)
  ✔ handles "..." in constraint (1.51969ms)
  ✔ handles "[TBD]" in goal (1.419282ms)
  ✔ handles "[TBD]" in constraint (1.58377ms)
  ✔ handles "(TBD)" in goal (1.582488ms)
  ✔ handles "(TBD)" in constraint (1.614559ms)
  ✔ handles "TO BE DETERMINED" in goal (1.47705ms)
  ✔ handles "TO BE DETERMINED" in constraint (2.406233ms)
  ✔ handles "TO DO" in goal (1.536692ms)
  ✔ handles "TO DO" in constraint (1.618997ms)
  ✔ handles "PLACEHOLDER" in goal (1.468014ms)
  ✔ handles "PLACEHOLDER" in constraint (1.565737ms)
  ✔ handles "XXX" in goal (1.416958ms)
  ✔ handles "XXX" in constraint (1.58367ms)
  ✔ handles "<<INSERT HERE>>" in goal (1.482401ms)
  ✔ handles "<<INSERT HERE>>" in constraint (1.621652ms)
  ✔ handles "<TBD>" in goal (1.411587ms)
  ✔ handles "<TBD>" in constraint (1.529639ms)
  ✔ handles "{TBD}" in goal (1.422237ms)
  ✔ handles "{TBD}" in constraint (1.535229ms)
  ✔ handles "NEEDS_WORK" in goal (1.414513ms)
  ✔ handles "NEEDS_WORK" in constraint (2.245692ms)
  ✔ goal consisting entirely of placeholders (0.137297ms)
  ✔ many placeholders increase entropy (3.685663ms)
  ✔ mixed real content and placeholders (2.619343ms)
  ✔ placeholder-like strings that are not placeholders (1.864467ms)
✔ Adversarial: Placeholder Density (56.746119ms)
▶ Adversarial Corpus Summary
  ✔ corpus contains expected number of fixtures (0.037821ms)
✔ Adversarial Corpus Summary (0.070021ms)
▶ Bundle Spec Invariants
  ▶ BS1: Schema Version Present
    ✔ simple intent has schema_version (12.875578ms)
    ✔ complex intent has schema_version (7.030947ms)
  ✔ BS1: Schema Version Present (20.51114ms)
  ▶ BS2: Hash Stability
    ✔ simple intent produces stable hash (9.596419ms)
    ✔ complex intent produces stable hash (10.741276ms)
    ✔ minimal intent produces stable hash (0.691908ms)
  ✔ BS2: Hash Stability (21.318704ms)
  ▶ BS3: Artifact Path Sorted
    ✔ simple intent outputs are sorted by path (4.774735ms)
    ✔ complex intent outputs are sorted by path (3.808703ms)
  ✔ BS3: Artifact Path Sorted (8.762204ms)
  ▶ BS4: Constraints Sorted
    ✔ simple intent constraints are sorted (2.93783ms)
    ✔ complex intent constraints are sorted (3.773688ms)
    ✔ constraint order in input does not affect sorting (0.486864ms)
  ✔ BS4: Constraints Sorted (7.335869ms)
  ▶ BS5: Questions Sorted
    ✔ simple intent questions are sorted (2.732665ms)
    ✔ complex intent questions are sorted (3.107468ms)
  ✔ BS5: Questions Sorted (5.922458ms)
  ▶ BS6: Terminal Nodes Sorted
    ✔ simple intent terminal nodes are sorted (2.561915ms)
    ✔ complex intent terminal nodes are sorted (3.581617ms)
  ✔ BS6: Terminal Nodes Sorted (6.236527ms)
  ▶ BS7: No Path Traversal
    ✔ simple intent has no path traversal (2.919997ms)
    ✔ complex intent has no path traversal (4.286149ms)
  ✔ BS7: No Path Traversal (7.322845ms)
  ▶ BS8: Canonical Idempotent
    ✔ simple intent is canonically idempotent (2.433033ms)
    ✔ complex intent is canonically idempotent (3.110393ms)
  ✔ BS8: Canonical Idempotent (5.63035ms)
  ▶ All Invariants Combined
    ✔ simple intent passes all invariants (2.382729ms)
    ✔ complex intent passes all invariants (3.632603ms)
    ✔ minimal intent passes all invariants (0.285115ms)
  ✔ All Invariants Combined (6.41391ms)
  ▶ Real Intents from Manifest
    ✔ loads manifest successfully (0.146865ms)
    ✔ all non-refusing intents pass bundle spec invariants (54.742762ms)
  ✔ Real Intents from Manifest (60.332115ms)
✔ Bundle Spec Invariants (150.438534ms)
▶ Canonical Serialization
  ✔ produces stable output for objects with different key insertion order (0.648015ms)
  ✔ produces stable output for nested objects (0.242495ms)
  ✔ handles arrays in index order (0.126137ms)
  ✔ round-trips through JSON parse (0.210324ms)
  ✔ rejects unsupported values (0.542497ms)
✔ Canonical Serialization (2.560171ms)
▶ Hash Stability
  ✔ produces identical hash for identical objects (0.65548ms)
  ✔ produces different hash for different objects (0.281057ms)
  ✔ produces consistent hash across multiple calls (1.540429ms)
✔ Hash Stability (2.683874ms)
▶ Transform Determinism
  ✔ produces identical bundle for simple intent (same process) (19.051211ms)
  ✔ produces identical bundle for complex intent (11.460585ms)
  ✔ produces identical bundle for minimal intent (0.907702ms)
  ✔ produces different bundle for different intents (9.662753ms)
  ✔ constraint order does not affect output (0.366828ms)
✔ Transform Determinism (41.788757ms)
▶ Validation Gates
  ✔ simple intent bundle passes all gates (4.229453ms)
  ✔ complex intent bundle passes all gates (3.678419ms)
  ✔ minimal intent bundle passes all gates (0.364373ms)
✔ Validation Gates (8.388102ms)
▶ Mutation Resistance
  ✔ deliberately randomized key insertion produces identical output (0.217769ms)
  ✔ repeated transforms produce identical bundle sequence (26.783424ms)
✔ Mutation Resistance (27.095239ms)
▶ Edge Cases
  ✔ handles empty constraints (0.223679ms)
  ✔ handles unicode in goal (4.671031ms)
  ✔ handles special characters in constraints (0.2611ms)
✔ Edge Cases (5.250838ms)
▶ Golden Hash Verification
  ✔ Golden Intent 001: User Authentication System (11.659507ms)
  ✔ Golden Intent 002: Hello World (0.493495ms)
  ✔ Golden Intent 003: REST API Server (7.05924ms)
✔ Golden Hash Verification (19.975434ms)
▶ Cross-Process Determinism
  ✔ can serialize and deserialize bundle for verification (4.551066ms)
✔ Cross-Process Determinism (4.715024ms)
▶ I1: Canonicalization Idempotence
  ✔ canonical(parse(canonical(x))) == canonical(x) for all seeds (2.541877ms)
  ✔ canonicalize is stable for objects with shuffled keys (0.397515ms)
  ✔ canonicalize round-trips through bytes (0.667051ms)
✔ I1: Canonicalization Idempotence (4.261873ms)
▶ I2: Normalization Idempotence
  ✔ normalizeIntent(normalizeIntent(x)) produces same result (1.92492ms)
  ✔ normalizeString is idempotent (0.364944ms)
  ✔ normalizeConstraint is idempotent (0.148689ms)
  ✔ normalizeConstraints is idempotent and sorted (1.22081ms)
✔ I2: Normalization Idempotence (3.91876ms)
▶ I3: Hash Stability
  ✔ canonicalHash produces same result across N runs (1.895014ms)
  ✔ bundle hash is stable across N transforms of same intent (87.686741ms)
  ✔ different intents produce different hashes (0.377928ms)
✔ I3: Hash Stability (90.129862ms)
▶ I4: Ordering Invariants
  ✔ outputs are always sorted by path (15.031602ms)
  ✔ unresolved_questions are sorted by (priority desc, id asc) (16.101789ms)
  ✔ terminal_nodes are sorted by id (14.607527ms)
  ✔ constraints within nodes are always sorted (13.873811ms)
✔ I4: Ordering Invariants (59.773888ms)
▶ I5: Validator Completeness
  ✔ empty goal always rejected (0.493275ms)
  ✔ missing required field (goal) always rejected (0.244749ms)
  ✔ contradictory constraints are detected and handled (37.831244ms)
  ✔ unicode normalization is consistent (NFC vs NFD) (0.161553ms)
  ✔ zero-width characters are handled consistently (32.187759ms)
  ✔ extremely long strings are handled without crash (9.993043ms)
  ✔ many constraints are handled deterministically (228.009061ms)
✔ I5: Validator Completeness (309.164852ms)
▶ Property Test Summary
  ✔ ran property tests across 100 seeds (0.132809ms)
✔ Property Test Summary (0.196668ms)
▶ Contradictory Constraints
  ✔ detects synchronous vs asynchronous contradiction (12.089013ms)
  ✔ detects public vs private contradiction (6.154563ms)
  ✔ detects required vs optional contradiction (0.252493ms)
  ✔ handles contradictions gracefully without crashing (1.152782ms)
✔ Contradictory Constraints (20.982303ms)
▶ Underspecified Intents
  ✔ handles minimal intent (just goal) (0.4531ms)
  ✔ detects high entropy for vague goals (0.178645ms)
  ✔ handles placeholder content (0.194425ms)
  ✔ handles TODO markers in constraints (0.118472ms)
✔ Underspecified Intents (1.176928ms)
▶ Adversarial Wording
  ✔ handles extremely long goal (29.705975ms)
  ✔ handles extremely long constraints (5.340597ms)
  ✔ handles many constraints (19.656998ms)
  ✔ handles special characters in goal (2.262684ms)
  ✔ handles unicode edge cases (3.991877ms)
  ✔ handles newlines and whitespace (0.275507ms)
  ✔ handles empty strings in constraints array (0.07991ms)
  ✔ handles duplicate constraints (0.033603ms)
✔ Adversarial Wording (61.627054ms)
▶ Malformed Inputs
  ✔ rejects empty goal (0.240581ms)
  ✔ rejects whitespace-only goal (0.067596ms)
  ✔ handles constraints as undefined (0.036749ms)
  ✔ handles context as undefined (0.022452ms)
✔ Malformed Inputs (0.419977ms)
▶ Boundary Conditions
  ✔ handles single character goal (0.308719ms)
  ✔ produces deterministic output for near-identical inputs (4.357593ms)
  ✔ handles maximum decomposition depth gracefully (3.983962ms)
  ✔ handles zero entropy case (0.280386ms)
✔ Boundary Conditions (9.041618ms)
▶ Security Edge Cases
  ✔ handles potential injection in goal (2.37813ms)
  ✔ handles potential path traversal in constraints (0.183134ms)
  ✔ handles extremely nested context (0.178695ms)
✔ Security Edge Cases (2.816362ms)
▶ Bundle CLI Functions
  ▶ bundle-verify behavior
    ✔ returns ok:true for valid bundle (5.300141ms)
    ✔ returns ok:false with violations for invalid bundle (1.257629ms)
    ✔ output is deterministic (0.828494ms)
  ✔ bundle-verify behavior (7.988233ms)
  ▶ bundle-summarize behavior
    ✔ produces canonical JSON summary for valid bundle (1.340004ms)
    ✔ summary includes all required fields (0.925536ms)
    ✔ output keys are sorted (canonical) (1.036785ms)
    ✔ output is byte-identical across runs (0.702197ms)
  ✔ bundle-summarize behavior (4.31904ms)
  ▶ Error handling patterns
    ✔ verify handles malformed input gracefully (0.251893ms)
    ✔ verify handles array input (0.092885ms)
    ✔ verify handles primitive input (0.110768ms)
  ✔ Error handling patterns (0.60234ms)
✔ Bundle CLI Functions (13.306708ms)
▶ Verifier Report Ingestion
  ▶ validateFolderName
    ✔ accepts valid folder names (5.794609ms)
    ✔ accepts folder names with underscores in verifier_id (0.733155ms)
    ✔ accepts folder names with hyphens in verifier_id (1.089554ms)
    ✔ rejects invalid format (0.9064ms)
    ✔ rejects missing date (0.652433ms)
    ✔ rejects invalid date (0.510156ms)
  ✔ validateFolderName (10.85561ms)
  ▶ validateRequiredFiles
    ✔ passes when VERIFIER_REPORT.md exists (2.19694ms)
    ✔ fails when VERIFIER_REPORT.md is missing (1.404204ms)
  ✔ validateRequiredFiles (3.858206ms)
  ▶ validateJsonSchema
    ✔ accepts valid JSON with all required fields (1.693797ms)
    ✔ rejects JSON missing required fields (1.019462ms)
    ✔ rejects invalid schema_version (1.413551ms)
    ✔ rejects malformed JSON (1.07696ms)
  ✔ validateJsonSchema (5.528168ms)
  ▶ parseMarkdownReport
    ✔ parses valid markdown report correctly (1.31719ms)
    ✔ fails with stable error when verifier_kind is missing (0.847008ms)
    ✔ detects version mismatch (0.808346ms)
    ✔ reports missing verifier_kind with stable error message (0.468418ms)
    ✔ reports other missing fields after verifier_kind present (0.60801ms)
  ✔ parseMarkdownReport (4.347454ms)
  ▶ Index Entry Management
    ✔ formats table row correctly (0.631244ms)
    ✔ parses existing entries from index content (0.769774ms)
    ✔ detects duplicates correctly (0.374372ms)
  ✔ Index Entry Management (1.931533ms)
  ▶ Valid submission with JSON passes and updates index deterministically
    ✔ parses and validates correctly (2.182413ms)
  ✔ Valid submission with JSON passes and updates index deterministically (2.304993ms)
  ▶ Valid submission without JSON passes
    ✔ parses markdown-only submission correctly (0.588123ms)
  ✔ Valid submission without JSON passes (0.686468ms)
  ▶ Invalid JSON fails with stable error message
    ✔ produces consistent error for invalid JSON (0.887184ms)
  ✔ Invalid JSON fails with stable error message (1.007299ms)
✔ Verifier Report Ingestion (31.16432ms)
▶ Reference Release Tagging
  ▶ validateRelease
    ✔ accepts valid release format (3.509993ms)
    ✔ rejects invalid release format (0.833022ms)
  ✔ validateRelease (4.857741ms)
  ▶ validateDate
    ✔ accepts valid date format (1.017669ms)
    ✔ rejects invalid date format (0.598392ms)
    ✔ requires date when not dry-run (0.614222ms)
    ✔ allows missing date in dry-run mode (0.400591ms)
  ✔ validateDate (2.936398ms)
  ▶ parseMarkdownForVerification
    ✔ parses internal verifier_kind (0.944741ms)
    ✔ parses independent verifier_kind (0.484298ms)
    ✔ returns null for missing verifier_kind (1.662668ms)
  ✔ parseMarkdownForVerification (3.436165ms)
  ▶ loadInternalReports
    ✔ loads only internal reports from fixture (1.801118ms)
    ✔ returns empty array when only independent reports exist (0.919345ms)
    ✔ returns empty array when no verified folder (0.450645ms)
  ✔ loadInternalReports (3.378457ms)
  ▶ checkIndexAlreadyRecorded
    ✔ returns false when Reference Tag not recorded (1.091207ms)
    ✔ returns true when Reference Tag already recorded (0.391514ms)
  ✔ checkIndexAlreadyRecorded (1.59459ms)
  ▶ updateIndexWithReferenceTag
    ✔ adds Reference Tag row to INDEX.md (0.760226ms)
    ✔ produces deterministic output (0.546986ms)
  ✔ updateIndexWithReferenceTag (1.405737ms)
  ▶ createStubGitHelper
    ✔ returns configured commit for rev-parse (0.432531ms)
    ✔ reports tag existence correctly (1.015675ms)
  ✔ createStubGitHelper (1.538305ms)
  ▶ Threshold not met
    ✔ returns exit code 2 when no internal reports exist (0.520507ms)
    ✔ independent-only reports do NOT count toward reference threshold (0.62953ms)
  ✔ Threshold not met (1.248332ms)
  ▶ Threshold met dry-run
    ✔ outputs JSON with expected reference tag name (0.878267ms)
  ✔ Threshold met dry-run (0.981391ms)
  ▶ Already recorded
    ✔ refuses with stable message when INDEX.md already has Reference Tag (0.556374ms)
  ✔ Already recorded (0.641263ms)
  ▶ Determinism
    ✔ produces stable error messages (0.564749ms)
    ✔ produces stable report loading order (0.754024ms)
    ✔ dry-run JSON output is byte-identical across runs (0.963357ms)
  ✔ Determinism (2.439295ms)
✔ Reference Release Tagging (25.21408ms)
▶ Verified Release Tagging
  ▶ validateRelease
    ✔ accepts valid release format (4.050256ms)
    ✔ rejects invalid release format (0.866766ms)
  ✔ validateRelease (5.493524ms)
  ▶ validateDate
    ✔ accepts valid date format (1.091657ms)
    ✔ rejects invalid date format (0.58123ms)
    ✔ requires date when not dry-run (0.987091ms)
    ✔ allows missing date in dry-run mode (0.571642ms)
  ✔ validateDate (3.596626ms)
  ▶ validateThreshold
    ✔ accepts valid threshold (0.647244ms)
    ✔ rejects invalid threshold (1.253381ms)
  ✔ validateThreshold (2.126839ms)
  ▶ parseMarkdownForVerification
    ✔ parses valid verified report with verifier_kind (1.048647ms)
    ✔ parses internal verifier_kind (0.598863ms)
    ✔ returns null for missing verifier_kind (0.341401ms)
    ✔ detects failed result (0.341581ms)
    ✔ handles missing fields (0.338956ms)
    ✔ handles placeholder fields (0.538761ms)
  ✔ parseMarkdownForVerification (3.472042ms)
  ▶ loadVerifiedReports
    ✔ loads valid reports from fixture with verifier_kind (1.769068ms)
    ✔ returns empty array when no verified folder (0.52218ms)
    ✔ excludes reports with missing required fields (0.808326ms)
    ✔ loads internal reports when present (1.760281ms)
  ✔ loadVerifiedReports (5.170628ms)
  ▶ checkIndexAlreadyRecorded
    ✔ returns false when not recorded (0.988213ms)
    ✔ returns true when already recorded (0.50627ms)
  ✔ checkIndexAlreadyRecorded (1.641489ms)
  ▶ updateIndexWithVerifiedTag
    ✔ adds Verified Tag row to INDEX.md (0.909906ms)
    ✔ produces deterministic output (1.0074ms)
  ✔ updateIndexWithVerifiedTag (2.109206ms)
  ▶ createStubGitHelper
    ✔ returns configured commit for rev-parse (0.460254ms)
    ✔ reports tag existence correctly (0.336471ms)
  ✔ createStubGitHelper (0.918994ms)
  ▶ Threshold not met
    ✔ returns exit code 2 with exact error string for no reports (0.650881ms)
    ✔ internal-only reports do NOT count toward verified threshold (0.477185ms)
  ✔ Threshold not met (1.243723ms)
  ▶ Threshold met dry-run
    ✔ outputs JSON with expected tag name and verifier_kind counts (1.624697ms)
  ✔ Threshold met dry-run (1.719445ms)
  ▶ Invalid report with missing fields
    ✔ tool refuses to count reports with missing OS/node/npm (0.553388ms)
  ✔ Invalid report with missing fields (0.625072ms)
  ▶ Already verified recorded
    ✔ refuses with stable message when INDEX.md already has Verified Tag (0.520917ms)
  ✔ Already verified recorded (0.592782ms)
  ▶ Determinism
    ✔ produces stable error messages (0.505158ms)
    ✔ produces stable report loading order (0.848271ms)
    ✔ dry-run JSON output is byte-identical across runs (0.913924ms)
  ✔ Determinism (2.405071ms)
✔ Verified Release Tagging (32.085317ms)
ℹ tests 506
ℹ suites 141
ℹ pass 506
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 710.387892
