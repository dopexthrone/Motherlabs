
> context-engine-kernel@0.1.0 test
> node --test dist/tests/*.test.js dist/harness/tests/*.test.js

▶ Harness: Plan-Only Mode
  ✔ processes simple intent without execution (4.466932ms)
  ✔ handles clarify result for vague intent (6.200469ms)
  ✔ produces deterministic results for same intent (1.1228ms)
✔ Harness: Plan-Only Mode (12.325205ms)
▶ Harness: Execute-Sandbox Mode
  ✔ executes proposal in sandbox and captures evidence (3.103611ms)
  ✔ sandbox never writes outside sandbox dir (2.36339ms)
  ✔ respects policy timeout (0.15419ms)
✔ Harness: Execute-Sandbox Mode (5.839982ms)
▶ Harness: Policy Profiles
  ✔ strict policy has most restrictive settings (0.222358ms)
  ✔ default policy is balanced (0.121158ms)
  ✔ dev policy is relaxed (0.511721ms)
  ✔ policy is included in result (1.381436ms)
✔ Harness: Policy Profiles (2.468057ms)
▶ Harness: Kernel Authority
  ✔ kernel generates bundle (harness does not) (0.677593ms)
  ✔ kernel validates evidence (harness does not decide) (1.844655ms)
✔ Harness: Kernel Authority (2.639048ms)
▶ Harness: Result Structure
  ✔ result has all required fields (0.997675ms)
  ✔ timestamps are valid ISO 8601 UTC (1.728357ms)
✔ Harness: Result Structure (2.877527ms)
▶ Security: Symlink Escape
  ✔ refuses to follow symlinks in output directory (4.032165ms)
  ✔ refuses to follow directory symlinks (0.868491ms)
✔ Security: Symlink Escape (5.326207ms)
▶ Security: Path Traversal
  ✔ validates isPathSafe correctly (4.078482ms)
  ✔ rejects absolute paths in output (0.928444ms)
✔ Security: Path Traversal (5.167027ms)
▶ Security: File Spam
  ✔ respects max_output_files limit (29.9087ms)
  ✔ respects max_total_output_bytes limit (23.440538ms)
✔ Security: File Spam (53.624857ms)
▶ Security: Deep Recursion
  ✔ limits directory traversal depth (3.527848ms)
  ✔ allows directories within depth limit (1.137758ms)
✔ Security: Deep Recursion (4.823532ms)
▶ Security: Combined Attacks
  ✔ handles multiple security issues simultaneously (7.818218ms)
✔ Security: Combined Attacks (7.918667ms)
▶ MockModelAdapter
  ✔ should return configured response for exact prompt (1.17101ms)
  ✔ should throw AdapterError for unmatched prompt in strict mode (0.336402ms)
  ✔ should echo prompt in echo mode (0.084659ms)
  ✔ should return fixed content in fixed mode (0.0694ms)
  ✔ should match substring patterns (0.07973ms)
  ✔ should record interactions when enabled (0.185448ms)
  ✔ should export recording session (0.10089ms)
  ✔ should report ready state correctly (0.076935ms)
  ✔ should have correct adapter_id and model_id (0.090339ms)
  ✔ should estimate tokens from content length (0.112721ms)
✔ MockModelAdapter (2.817113ms)
▶ RecordingModelAdapter
  ✔ should record interactions from delegate (3.345566ms)
  ✔ should delegate transform calls correctly (0.11745ms)
  ✔ should compute stats correctly (0.120346ms)
  ✔ should respect max_interactions limit (0.121959ms)
  ✔ should redact prompts when include_prompts is false (0.093245ms)
  ✔ should delegate isReady and shutdown (0.058199ms)
✔ RecordingModelAdapter (4.000806ms)
▶ ReplayModelAdapter
  ✔ should replay recorded response by prompt hash (0.269166ms)
  ✔ should throw for unrecorded prompt in strict mode (0.109947ms)
  ✔ should return empty content for unrecorded prompt in non-strict mode (0.043041ms)
  ✔ should enforce sequence order in sequential mode (0.043892ms)
  ✔ should fail in sequential mode if prompts are out of order (0.057989ms)
  ✔ should report recording count (0.053361ms)
  ✔ should check hasRecording correctly (0.060043ms)
  ✔ should always be ready (0.057107ms)
✔ ReplayModelAdapter (0.788361ms)
▶ Record and Replay Integration
  ✔ should produce identical results when replaying recorded session (0.428866ms)
  ✔ should create adapter from recording session (0.104677ms)
✔ Record and Replay Integration (0.578978ms)
▶ Adapter Determinism
  ✔ should produce identical results across multiple runs (0.112982ms)
  ✔ should produce same hash for same prompt regardless of context metadata (0.05323ms)
✔ Adapter Determinism (0.221987ms)
▶ Adversarial: Unicode Normalization
  ✔ A-umlaut: NFC and NFD produce identical normalized output (0.554291ms)
  ✔ O-umlaut: NFC and NFD produce identical normalized output (0.075622ms)
  ✔ U-umlaut: NFC and NFD produce identical normalized output (0.043271ms)
  ✔ e-acute: NFC and NFD produce identical normalized output (0.049583ms)
  ✔ n-tilde: NFC and NFD produce identical normalized output (0.047409ms)
  ✔ c-cedilla: NFC and NFD produce identical normalized output (0.039805ms)
  ✔ a-grave: NFC and NFD produce identical normalized output (0.030066ms)
  ✔ mixed NFC/NFD in constraints produce identical hashes (0.492946ms)
  ✔ Korean Hangul syllables (precomposed vs jamo) (11.792685ms)
✔ Adversarial: Unicode Normalization (13.848838ms)
▶ Adversarial: Zero-Width Characters
  ✔ ZWSP at start of goal is handled (4.860802ms)
  ✔ ZWSP at end of goal is handled (3.658043ms)
  ✔ ZWSP in middle of goal is handled (3.621253ms)
  ✔ multiple ZWSP in constraints are handled (3.276896ms)
  ✔ ZWNJ at start of goal is handled (2.635862ms)
  ✔ ZWNJ at end of goal is handled (2.288539ms)
  ✔ ZWNJ in middle of goal is handled (2.48049ms)
  ✔ multiple ZWNJ in constraints are handled (2.173694ms)
  ✔ ZWJ at start of goal is handled (1.96968ms)
  ✔ ZWJ at end of goal is handled (1.835197ms)
  ✔ ZWJ in middle of goal is handled (1.869292ms)
  ✔ multiple ZWJ in constraints are handled (2.033721ms)
  ✔ BOM at start of goal is handled (2.903555ms)
  ✔ BOM at end of goal is handled (2.354333ms)
  ✔ BOM in middle of goal is handled (1.849845ms)
  ✔ multiple BOM in constraints are handled (2.104464ms)
  ✔ WJ at start of goal is handled (1.941568ms)
  ✔ WJ at end of goal is handled (1.709882ms)
  ✔ WJ in middle of goal is handled (1.955484ms)
  ✔ multiple WJ in constraints are handled (2.196727ms)
  ✔ NBSP at start of goal is handled (2.149337ms)
  ✔ NBSP at end of goal is handled (2.073065ms)
  ✔ NBSP in middle of goal is handled (1.556664ms)
  ✔ multiple NBSP in constraints are handled (1.887646ms)
  ✔ NNBSP at start of goal is handled (2.348703ms)
  ✔ NNBSP at end of goal is handled (1.611587ms)
  ✔ NNBSP in middle of goal is handled (2.039171ms)
  ✔ multiple NNBSP in constraints are handled (1.882046ms)
  ✔ RTL override characters are handled safely (0.303009ms)
  ✔ combining diacritical marks are handled (2.09707ms)
✔ Adversarial: Zero-Width Characters (68.494112ms)
▶ Adversarial: Extremely Long Strings
  ✔ goal with 10,000 characters (24.471855ms)
  ✔ goal with 50,000 characters (53.567559ms)
  ✔ 100 constraints each with 1,000 characters (202.469444ms)
  ✔ single constraint with 100,000 characters (156.784075ms)
  ✔ deeply nested context object (1.871556ms)
  ✔ context with 1000 keys (2.285804ms)
✔ Adversarial: Extremely Long Strings (441.6826ms)
▶ Adversarial: Contradictory Constraints
  ✔ handles sync/async contradiction gracefully (2.215352ms)
  ✔ handles public/private contradiction gracefully (2.122808ms)
  ✔ handles sql/nosql contradiction gracefully (2.218869ms)
  ✔ handles rest/graphql contradiction gracefully (2.164256ms)
  ✔ handles monolith/microservice contradiction gracefully (3.061292ms)
  ✔ handles stateless/stateful contradiction gracefully (1.759886ms)
  ✔ handles online/offline contradiction gracefully (1.817054ms)
  ✔ handles single/multi-tenant contradiction gracefully (1.71919ms)
  ✔ handles open/closed-source contradiction gracefully (1.747113ms)
  ✔ handles real-time/batch contradiction gracefully (1.828706ms)
  ✔ multiple contradictions in same intent (2.287628ms)
  ✔ subtle contradiction: performance vs simplicity (2.502001ms)
✔ Adversarial: Contradictory Constraints (25.660659ms)
▶ Adversarial: List Ordering Attacks
  ✔ shuffled constraints produce identical bundle hash (7.436992ms)
  ✔ duplicates in different positions produce identical hash (3.36372ms)
  ✔ whitespace variations in constraints produce identical hash (4.851715ms)
  ✔ context key ordering is deterministic (0.290065ms)
✔ Adversarial: List Ordering Attacks (16.042329ms)
▶ Adversarial: Placeholder Density
  ✔ handles "TBD" in goal (1.832282ms)
  ✔ handles "TBD" in constraint (1.642516ms)
  ✔ handles "TODO" in goal (1.486753ms)
  ✔ handles "TODO" in constraint (1.609524ms)
  ✔ handles "FIXME" in goal (1.449413ms)
  ✔ handles "FIXME" in constraint (1.583995ms)
  ✔ handles "???" in goal (1.440597ms)
  ✔ handles "???" in constraint (2.181248ms)
  ✔ handles "..." in goal (1.450415ms)
  ✔ handles "..." in constraint (1.928473ms)
  ✔ handles "[TBD]" in goal (1.658185ms)
  ✔ handles "[TBD]" in constraint (1.667082ms)
  ✔ handles "(TBD)" in goal (1.475853ms)
  ✔ handles "(TBD)" in constraint (1.577594ms)
  ✔ handles "TO BE DETERMINED" in goal (1.479179ms)
  ✔ handles "TO BE DETERMINED" in constraint (1.626366ms)
  ✔ handles "TO DO" in goal (1.438602ms)
  ✔ handles "TO DO" in constraint (1.612319ms)
  ✔ handles "PLACEHOLDER" in goal (1.463369ms)
  ✔ handles "PLACEHOLDER" in constraint (1.564109ms)
  ✔ handles "XXX" in goal (2.143597ms)
  ✔ handles "XXX" in constraint (1.593073ms)
  ✔ handles "<<INSERT HERE>>" in goal (1.473538ms)
  ✔ handles "<<INSERT HERE>>" in constraint (1.624001ms)
  ✔ handles "<TBD>" in goal (1.413746ms)
  ✔ handles "<TBD>" in constraint (1.525517ms)
  ✔ handles "{TBD}" in goal (1.525807ms)
  ✔ handles "{TBD}" in constraint (1.5809ms)
  ✔ handles "NEEDS_WORK" in goal (1.446868ms)
  ✔ handles "NEEDS_WORK" in constraint (1.578936ms)
  ✔ goal consisting entirely of placeholders (0.133591ms)
  ✔ many placeholders increase entropy (4.25302ms)
  ✔ mixed real content and placeholders (2.502ms)
  ✔ placeholder-like strings that are not placeholders (2.666169ms)
✔ Adversarial: Placeholder Density (58.047225ms)
▶ Adversarial Corpus Summary
  ✔ corpus contains expected number of fixtures (0.044924ms)
✔ Adversarial Corpus Summary (0.077896ms)
▶ Canonical Serialization
  ✔ produces stable output for objects with different key insertion order (0.391776ms)
  ✔ produces stable output for nested objects (0.096391ms)
  ✔ handles arrays in index order (0.085711ms)
  ✔ round-trips through JSON parse (0.126087ms)
  ✔ rejects unsupported values (0.326363ms)
✔ Canonical Serialization (1.475953ms)
▶ Hash Stability
  ✔ produces identical hash for identical objects (0.332104ms)
  ✔ produces different hash for different objects (0.080261ms)
  ✔ produces consistent hash across multiple calls (0.563719ms)
✔ Hash Stability (1.112951ms)
▶ Transform Determinism
  ✔ produces identical bundle for simple intent (same process) (13.400345ms)
  ✔ produces identical bundle for complex intent (11.987992ms)
  ✔ produces identical bundle for minimal intent (0.461737ms)
  ✔ produces different bundle for different intents (6.50392ms)
  ✔ constraint order does not affect output (0.428335ms)
✔ Transform Determinism (32.994748ms)
▶ Validation Gates
  ✔ simple intent bundle passes all gates (3.274091ms)
  ✔ complex intent bundle passes all gates (3.061632ms)
  ✔ minimal intent bundle passes all gates (0.261862ms)
✔ Validation Gates (6.68527ms)
▶ Mutation Resistance
  ✔ deliberately randomized key insertion produces identical output (0.198072ms)
  ✔ repeated transforms produce identical bundle sequence (25.608091ms)
✔ Mutation Resistance (25.884069ms)
▶ Edge Cases
  ✔ handles empty constraints (0.201749ms)
  ✔ handles unicode in goal (4.684271ms)
  ✔ handles special characters in constraints (0.25577ms)
✔ Edge Cases (5.230266ms)
▶ Golden Hash Verification
  ✔ Golden Intent 001: User Authentication System (9.720332ms)
  ✔ Golden Intent 002: Hello World (0.506782ms)
  ✔ Golden Intent 003: REST API Server (5.015553ms)
✔ Golden Hash Verification (15.821925ms)
▶ Cross-Process Determinism
  ✔ can serialize and deserialize bundle for verification (3.682879ms)
✔ Cross-Process Determinism (3.801142ms)
▶ I1: Canonicalization Idempotence
  ✔ canonical(parse(canonical(x))) == canonical(x) for all seeds (1.785604ms)
  ✔ canonicalize is stable for objects with shuffled keys (0.348024ms)
  ✔ canonicalize round-trips through bytes (0.970694ms)
✔ I1: Canonicalization Idempotence (3.757459ms)
▶ I2: Normalization Idempotence
  ✔ normalizeIntent(normalizeIntent(x)) produces same result (1.635904ms)
  ✔ normalizeString is idempotent (0.277261ms)
  ✔ normalizeConstraint is idempotent (0.114775ms)
  ✔ normalizeConstraints is idempotent and sorted (1.240361ms)
✔ I2: Normalization Idempotence (3.468877ms)
▶ I3: Hash Stability
  ✔ canonicalHash produces same result across N runs (1.413155ms)
  ✔ bundle hash is stable across N transforms of same intent (82.759493ms)
  ✔ different intents produce different hashes (0.348986ms)
✔ I3: Hash Stability (84.671605ms)
▶ I4: Ordering Invariants
  ✔ outputs are always sorted by path (14.804172ms)
  ✔ unresolved_questions are sorted by (priority desc, id asc) (13.830043ms)
  ✔ terminal_nodes are sorted by id (13.42391ms)
  ✔ constraints within nodes are always sorted (13.69557ms)
✔ I4: Ordering Invariants (55.891826ms)
▶ I5: Validator Completeness
  ✔ empty goal always rejected (0.380385ms)
  ✔ missing required field (goal) always rejected (0.236445ms)
  ✔ contradictory constraints are detected and handled (35.897671ms)
  ✔ unicode normalization is consistent (NFC vs NFD) (0.168848ms)
  ✔ zero-width characters are handled consistently (31.962068ms)
  ✔ extremely long strings are handled without crash (10.494416ms)
  ✔ many constraints are handled deterministically (214.828614ms)
✔ I5: Validator Completeness (294.205551ms)
▶ Property Test Summary
  ✔ ran property tests across 100 seeds (0.140615ms)
✔ Property Test Summary (0.205787ms)
▶ Contradictory Constraints
  ✔ detects synchronous vs asynchronous contradiction (9.381585ms)
  ✔ detects public vs private contradiction (5.114649ms)
  ✔ detects required vs optional contradiction (0.18611ms)
  ✔ handles contradictions gracefully without crashing (1.068327ms)
✔ Contradictory Constraints (16.307137ms)
▶ Underspecified Intents
  ✔ handles minimal intent (just goal) (0.284545ms)
  ✔ detects high entropy for vague goals (0.11133ms)
  ✔ handles placeholder content (0.115056ms)
  ✔ handles TODO markers in constraints (3.221212ms)
✔ Underspecified Intents (3.889938ms)
▶ Adversarial Wording
  ✔ handles extremely long goal (24.478558ms)
  ✔ handles extremely long constraints (4.34885ms)
  ✔ handles many constraints (18.421639ms)
  ✔ handles special characters in goal (2.732384ms)
  ✔ handles unicode edge cases (3.941875ms)
  ✔ handles newlines and whitespace (0.257785ms)
  ✔ handles empty strings in constraints array (0.079098ms)
  ✔ handles duplicate constraints (0.03184ms)
✔ Adversarial Wording (54.540466ms)
▶ Malformed Inputs
  ✔ rejects empty goal (0.230643ms)
  ✔ rejects whitespace-only goal (0.061555ms)
  ✔ handles constraints as undefined (0.040607ms)
  ✔ handles context as undefined (0.023945ms)
✔ Malformed Inputs (0.412034ms)
▶ Boundary Conditions
  ✔ handles single character goal (0.199685ms)
  ✔ produces deterministic output for near-identical inputs (4.094472ms)
  ✔ handles maximum decomposition depth gracefully (2.804218ms)
  ✔ handles zero entropy case (0.261651ms)
✔ Boundary Conditions (7.438646ms)
▶ Security Edge Cases
  ✔ handles potential injection in goal (2.016228ms)
  ✔ handles potential path traversal in constraints (0.167144ms)
  ✔ handles extremely nested context (0.158538ms)
✔ Security Edge Cases (2.408424ms)
ℹ tests 221
ℹ suites 42
ℹ pass 221
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 669.741301
